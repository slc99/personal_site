<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>Liam Connor</title>
<link>https://www.liamgconnor.com/projects/</link>
<atom:link href="https://www.liamgconnor.com/projects/index.xml" rel="self" type="application/rss+xml"/>
<description>Liam Connor&#39;s personal website.</description>
<generator>quarto-1.8.26</generator>
<lastBuildDate>Mon, 26 Jan 2026 07:00:00 GMT</lastBuildDate>
<item>
  <title>Farkle Calculator</title>
  <link>https://www.liamgconnor.com/projects/farkle-calculator/</link>
  <description><![CDATA[ 




<section id="farkle-dice-calculator" class="level1">
<h1>Farkle Dice Calculator</h1>
<p>Enter your six dice values and current score to find the optimal move!</p>
<div id="farkle-calculator">
    <div class="calculator-container">
        <div class="input-section">
            <h3 class="anchored" data-anchor-id="farkle-dice-calculator">üé≤ Your Dice</h3>
            <div class="dice-input-wrapper">
                <div class="dice-labels">
                    <div class="label-row">Dice:</div>
                    <div class="label-row locked-row">Locked?</div>
                </div>
                <div class="dice-container">
                    <div class="die-wrapper">
                        <select id="die1" class="die-select">
                            <option value="">‚ùì</option>
                            <option value="1">‚öÄ</option>
                            <option value="2">‚öÅ</option>
                            <option value="3">‚öÇ</option>
                            <option value="4">‚öÉ</option>
                            <option value="5">‚öÑ</option>
                            <option value="6">‚öÖ</option>
                        </select>
                        <input type="checkbox" id="lock1" class="lock-checkbox">
                    </div>
                    <div class="die-wrapper">
                        <select id="die2" class="die-select">
                            <option value="">‚ùì</option>
                            <option value="1">‚öÄ</option>
                            <option value="2">‚öÅ</option>
                            <option value="3">‚öÇ</option>
                            <option value="4">‚öÉ</option>
                            <option value="5">‚öÑ</option>
                            <option value="6">‚öÖ</option>
                        </select>
                        <input type="checkbox" id="lock2" class="lock-checkbox">
                    </div>
                    <div class="die-wrapper">
                        <select id="die3" class="die-select">
                            <option value="">‚ùì</option>
                            <option value="1">‚öÄ</option>
                            <option value="2">‚öÅ</option>
                            <option value="3">‚öÇ</option>
                            <option value="4">‚öÉ</option>
                            <option value="5">‚öÑ</option>
                            <option value="6">‚öÖ</option>
                        </select>
                        <input type="checkbox" id="lock3" class="lock-checkbox">
                    </div>
                    <div class="die-wrapper">
                        <select id="die4" class="die-select">
                            <option value="">‚ùì</option>
                            <option value="1">‚öÄ</option>
                            <option value="2">‚öÅ</option>
                            <option value="3">‚öÇ</option>
                            <option value="4">‚öÉ</option>
                            <option value="5">‚öÑ</option>
                            <option value="6">‚öÖ</option>
                        </select>
                        <input type="checkbox" id="lock4" class="lock-checkbox">
                    </div>
                    <div class="die-wrapper">
                        <select id="die5" class="die-select">
                            <option value="">‚ùì</option>
                            <option value="1">‚öÄ</option>
                            <option value="2">‚öÅ</option>
                            <option value="3">‚öÇ</option>
                            <option value="4">‚öÉ</option>
                            <option value="5">‚öÑ</option>
                            <option value="6">‚öÖ</option>
                        </select>
                        <input type="checkbox" id="lock5" class="lock-checkbox">
                    </div>
                    <div class="die-wrapper">
                        <select id="die6" class="die-select">
                            <option value="">‚ùì</option>
                            <option value="1">‚öÄ</option>
                            <option value="2">‚öÅ</option>
                            <option value="3">‚öÇ</option>
                            <option value="4">‚öÉ</option>
                            <option value="5">‚öÑ</option>
                            <option value="6">‚öÖ</option>
                        </select>
                        <input type="checkbox" id="lock6" class="lock-checkbox">
                    </div>
                </div>
            </div>
            
            <div class="controls-row">
                <div class="score-input">
                    <label for="current-score">Current Score</label>
                    <input type="number" id="current-score" value="0" min="0" max="19950" step="50">
                </div>
                
                <button id="clear-btn" class="clear-btn">Clear All</button>
            </div>
        </div>
        
        <div class="result-section">
            <h3 class="anchored">üéØ Optimal Moves</h3>
            
<table id="moves-table" class="moves-table caption-top table">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Dice</th>
<th data-quarto-table-cell-role="th">Keep</th>
<th data-quarto-table-cell-role="th">Expected Score</th>
<th data-quarto-table-cell-role="th">Chance of Bust</th>
</tr>
</thead>
<tbody id="moves-tbody">
<tr class="placeholder-row odd">
<td colspan="4">Select your dice to see optimal moves...</td>
</tr>
</tbody>
</table>

        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get all dice selects and lock checkboxes
    const diceSelects = [1, 2, 3, 4, 5, 6].map(i => document.getElementById(`die${i}`));
    const lockCheckboxes = [1, 2, 3, 4, 5, 6].map(i => document.getElementById(`lock${i}`));
    const currentScoreInput = document.getElementById('current-score');
    const movesTbody = document.getElementById('moves-tbody');
    const clearBtn = document.getElementById('clear-btn');
    
    let hasData = false; // Track if table has data rows
    
    // Add event listeners to all dice and locks
    diceSelects.forEach((select, idx) => {
        select.addEventListener('change', () => {
            updateCalculation();
        });
    });
    
    lockCheckboxes.forEach((checkbox, idx) => {
        checkbox.addEventListener('change', () => {
            const dieSelect = diceSelects[idx];
            if (checkbox.checked) {
                dieSelect.classList.add('locked');
            } else {
                dieSelect.classList.remove('locked');
            }
            updateCalculation();
        });
    });
    
    currentScoreInput.addEventListener('input', () => {
        validateAndFixScore();
        updateCalculation();
    });
    
    currentScoreInput.addEventListener('blur', () => {
        validateAndFixScore();
    });
    
    function validateAndFixScore() {
        let value = parseInt(currentScoreInput.value) || 0;
        
        // Ensure it's not negative
        if (value < 0) {
            value = 0;
        }
        
        // Ensure it's less than 20000
        if (value >= 20000) {
            value = 19950;
        }
        
        // Round to nearest 50
        value = Math.round(value / 50) * 50;
        
        currentScoreInput.value = value;
    }
    
    // Clear button functionality
    clearBtn.addEventListener('click', () => {
        diceSelects.forEach((select, idx) => {
            select.value = '';
            select.classList.remove('locked');
        });
        lockCheckboxes.forEach(checkbox => {
            checkbox.checked = false;
        });
        currentScoreInput.value = 0;
        movesTbody.innerHTML = '<tr class="placeholder-row"><td colspan="4">Select your dice to see optimal moves...</td></tr>';
        hasData = false;
    });
    
    function updateCalculation() {
        const dice = diceSelects.map(s => s.value ? parseInt(s.value) : null);
        const locks = lockCheckboxes.map(cb => cb.checked);
        const currentScore = parseInt(currentScoreInput.value) || 0;
        
        // Check if we have any dice selected
        if (!dice.some(d => d !== null)) {
            movesTbody.innerHTML = '<tr class="placeholder-row"><td colspan="4">Select your dice to see optimal moves...</td></tr>';
            hasData = false;
            return;
        }
        
        // Calculate optimal moves
        const moves = calculateOptimalMoves(dice, locks, currentScore);
        
        // Display moves with animation
        displayMoves(moves);
    }
    
    function calculateOptimalMoves(dice, locks, currentScore) {
        // PLACEHOLDER: Replace with your actual algorithm
        // This generates sample moves for demonstration
        
        const moves = [];
        const availableDice = dice.filter((d, i) => d !== null && !locks[i]);
        const lockedDice = dice.filter((d, i) => d !== null && locks[i]);
        
        if (availableDice.length === 0) {
            return [{
                dice: lockedDice,
                keep: '‚úì',
                expectedScore: currentScore,
                chanceOfBust: 0
            }];
        }
        
        // Generate some example moves (replace with actual logic)
        const combinations = [
            { keep: availableDice.slice(0, 2), score: 2000, bust: 39 },
            { keep: availableDice.slice(0, 1), score: 1000, bust: 32 },
            { keep: availableDice.filter(d => d === 1 || d === 5), score: 500, bust: 19 },
            { keep: [], score: 480, bust: 14 }
        ];
        
        combinations.forEach((combo, idx) => {
            if (idx < 4) {
                moves.push({
                    dice: [...lockedDice, ...combo.keep],
                    keep: combo.keep.length > 0 ? '‚úì' : '‚úó',
                    expectedScore: combo.score,
                    chanceOfBust: combo.bust
                });
            }
        });
        
        return moves;
    }
    
    function displayMoves(moves) {
        const isFirstTime = !hasData;
        
        if (isFirstTime) {
            // First time showing data - fade out placeholder, then show data
            const existingRows = movesTbody.querySelectorAll('tr');
            existingRows.forEach(row => {
                row.classList.add('fade-out');
            });
            
            setTimeout(() => {
                createRows(moves);
                hasData = true;
            }, 200);
        } else {
            // Update existing rows without collapsing table
            updateRows(moves);
        }
    }
    
    function createRows(moves) {
        movesTbody.innerHTML = '';
        
        moves.forEach((move, idx) => {
            setTimeout(() => {
                const row = document.createElement('tr');
                row.classList.add('move-row', 'fade-in');
                
                const diceEmojis = move.dice.map(d => getDieEmoji(d)).join(' ');
                
                row.innerHTML = `
                    <td class="dice-cell">${diceEmojis || '‚Äî'}</td>
                    <td class="keep-cell">${move.keep}</td>
                    <td class="score-cell" data-value="${move.expectedScore}">
                        <span class="number-animate">${move.expectedScore}</span>
                    </td>
                    <td class="bust-cell" data-value="${move.chanceOfBust}">
                        <span class="number-animate">${move.chanceOfBust}%</span>
                    </td>
                `;
                
                movesTbody.appendChild(row);
                
                // Trigger animation
                setTimeout(() => {
                    animateNumbers(row);
                }, 50);
            }, idx * 100);
        });
    }
    
    function updateRows(moves) {
        const existingRows = movesTbody.querySelectorAll('tr:not(.placeholder-row)');
        
        // Update or create rows as needed
        moves.forEach((move, idx) => {
            const diceEmojis = move.dice.map(d => getDieEmoji(d)).join(' ');
            
            if (idx < existingRows.length) {
                // Update existing row
                const row = existingRows[idx];
                const diceCell = row.querySelector('.dice-cell');
                const keepCell = row.querySelector('.keep-cell');
                const scoreCell = row.querySelector('.score-cell');
                const bustCell = row.querySelector('.bust-cell');
                
                // Update content with smooth transitions
                if (diceCell.textContent !== (diceEmojis || '‚Äî')) {
                    diceCell.style.opacity = '0.5';
                    setTimeout(() => {
                        diceCell.textContent = diceEmojis || '‚Äî';
                        diceCell.style.opacity = '1';
                    }, 150);
                }
                
                if (keepCell.textContent !== move.keep) {
                    keepCell.textContent = move.keep;
                }
                
                // Animate numbers if they changed
                const oldScore = parseInt(scoreCell.dataset.value);
                const oldBust = parseInt(bustCell.dataset.value);
                
                if (oldScore !== move.expectedScore || oldBust !== move.chanceOfBust) {
                    scoreCell.dataset.value = move.expectedScore;
                    bustCell.dataset.value = move.chanceOfBust;
                    
                    animateValue(scoreCell.querySelector('.number-animate'), oldScore, move.expectedScore, 500);
                    animateValue(bustCell.querySelector('.number-animate'), oldBust, move.chanceOfBust, 500, '%');
                }
            } else {
                // Create new row if we have more moves than existing rows
                const row = document.createElement('tr');
                row.classList.add('move-row', 'fade-in');
                
                row.innerHTML = `
                    <td class="dice-cell">${diceEmojis || '‚Äî'}</td>
                    <td class="keep-cell">${move.keep}</td>
                    <td class="score-cell" data-value="${move.expectedScore}">
                        <span class="number-animate">${move.expectedScore}</span>
                    </td>
                    <td class="bust-cell" data-value="${move.chanceOfBust}">
                        <span class="number-animate">${move.chanceOfBust}%</span>
                    </td>
                `;
                
                movesTbody.appendChild(row);
                
                setTimeout(() => {
                    animateNumbers(row);
                }, 50);
            }
        });
        
        // Remove extra rows if we have fewer moves
        for (let i = moves.length; i < existingRows.length; i++) {
            existingRows[i].classList.add('fade-out');
            setTimeout(() => {
                if (existingRows[i].parentNode) {
                    existingRows[i].remove();
                }
            }, 300);
        }
    }
    
    function animateNumbers(row) {
        const scoreCell = row.querySelector('.score-cell .number-animate');
        const bustCell = row.querySelector('.bust-cell .number-animate');
        
        const targetScore = parseInt(row.querySelector('.score-cell').dataset.value);
        const targetBust = parseInt(row.querySelector('.bust-cell').dataset.value);
        
        animateValue(scoreCell, 0, targetScore, 500);
        animateValue(bustCell, 0, targetBust, 500, '%');
    }
    
    function animateValue(element, start, end, duration, suffix = '') {
        const range = end - start;
        const increment = range / (duration / 16);
        let current = start;
        
        const timer = setInterval(() => {
            current += increment;
            if ((increment > 0 && current >= end) || (increment < 0 && current <= end)) {
                current = end;
                clearInterval(timer);
            }
            element.textContent = Math.round(current) + suffix;
        }, 16);
    }
    
    function getDieEmoji(value) {
        const emojiMap = {
            1: '‚öÄ',
            2: '‚öÅ',
            3: '‚öÇ',
            4: '‚öÉ',
            5: '‚öÑ',
            6: '‚öÖ'
        };
        return emojiMap[value] || '‚ùì';
    }
});
</script>
<div id="ec1be81d" class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Python calculation function (optional - can be used instead of JavaScript)</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># You can integrate your existing Farkle solver here</span></span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> calculate_optimal_farkle_move(dice, current_score):</span>
<span id="cb1-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Calculate the optimal move in Farkle.</span></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb1-8"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parameters:</span></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - dice: list of 6 integers (1-6) representing the rolled dice</span></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - current_score: integer representing the player's current score</span></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    </span></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Returns:</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    - dict with 'keep_dice' (list of dice to keep) and 'score' (points earned)</span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-15">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># </span><span class="al" style="color: #AD0000;
background-color: null;
font-style: inherit;">TODO</span><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">: Replace this with your actual Farkle solver algorithm</span></span>
<span id="cb1-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This is a placeholder implementation</span></span>
<span id="cb1-17">    </span>
<span id="cb1-18">    keep_dice <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb1-19">    score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb1-20">    </span>
<span id="cb1-21">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Count occurrences</span></span>
<span id="cb1-22">    <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">from</span> collections <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">import</span> Counter</span>
<span id="cb1-23">    counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Counter(dice)</span>
<span id="cb1-24">    </span>
<span id="cb1-25">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check for scoring combinations</span></span>
<span id="cb1-26">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> value, count <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> counts.items():</span>
<span id="cb1-27">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>:</span>
<span id="cb1-28">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Three of a kind or more</span></span>
<span id="cb1-29">            base_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1000</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-30">            multiplier <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span> (count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>)</span>
<span id="cb1-31">            score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> base_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> multiplier</span>
<span id="cb1-32">            keep_dice.extend([value] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> count)</span>
<span id="cb1-33">    </span>
<span id="cb1-34">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If no three of a kind, look for 1s and 5s</span></span>
<span id="cb1-35">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> keep_dice:</span>
<span id="cb1-36">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> die <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> dice:</span>
<span id="cb1-37">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> die <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb1-38">                keep_dice.append(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-39">                score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span></span>
<span id="cb1-40">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> die <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>:</span>
<span id="cb1-41">                keep_dice.append(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb1-42">                score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span></span>
<span id="cb1-43">    </span>
<span id="cb1-44">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> {</span>
<span id="cb1-45">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'keep_dice'</span>: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sorted</span>(keep_dice),</span>
<span id="cb1-46">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'score'</span>: score,</span>
<span id="cb1-47">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">'new_total'</span>: current_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> score</span>
<span id="cb1-48">    }</span>
<span id="cb1-49"></span>
<span id="cb1-50"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Example usage:</span></span>
<span id="cb1-51"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># result = calculate_optimal_farkle_move([1, 2, 3, 4, 5, 6], 500)</span></span>
<span id="cb1-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># print(result)</span></span></code></pre></div></div>
</details>
</div>


</section>

 ]]></description>
  <category>games</category>
  <category>probability</category>
  <category>algorithms</category>
  <category>data structures</category>
  <category>interactive</category>
  <guid>https://www.liamgconnor.com/projects/farkle-calculator/</guid>
  <pubDate>Mon, 26 Jan 2026 07:00:00 GMT</pubDate>
  <media:content url="https://www.liamgconnor.com/projects/farkle-calculator/image.png" medium="image" type="image/png"/>
</item>
<item>
  <title>Quote Machine</title>
  <link>https://www.liamgconnor.com/projects/quote-machine/</link>
  <description><![CDATA[ 




<p><br> <iframe src="https://slc99-quote-machine.hf.space" width="100%" height="800" style="box-shadow: 0 2px 8px var(--bs-body-color);"></iframe></p>
<section id="project-tldr" class="level3">
<h3 class="anchored" data-anchor-id="project-tldr">Project TLDR</h3>
<p><strong>End-to-end NLP project</strong> that predicts author metadata from text.</p>
<ul>
<li><strong>Data Engineering</strong>: Built a custom scraper for Wikiquote &amp; Wikimedia to curate a high-quality dataset of 200k+ quotes mapped to author metadata (birth year, occupation, gender).</li>
<li><strong>Modeling</strong>: Fine-tuned a Transformer-based architecture (Sentence-BERT backbone &amp; custom PyTorch heads) for multi-task learning.</li>
<li><strong>Deployment</strong>: Deployed a scalable inference API and interactive UI via Hugging Face Spaces &amp; Gradio, featuring vector-based semantic search using FAISS.</li>
</ul>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<!-- 
I believe that history can serve as a useful tool for understanding ourselves and our world. I think a useful starting point for the study of history is the understanding that historical people were not too dissimilar to ourselves and the people we know. I believe that it is far too easy to 'other' those who lived before us, which prevents us from learning from the past or drawing from it.

Recognizing the humanity we share with historic figures is a necessary step in understanding history and learning from it. It is far too easy to 'other' past generations and assume that our current reality is different to the point of irrelevance. A good quote can knock away this misconception, by reminding us of our shared humanity. On the opposite side, a 

Is it possible to tell a whether a quote is misattributed from the quote alone? Yes, Google it. 

I believe that missattributed quotes 

Historical figures are often mythicized

History is often 

It is hard to present history

It is hard to learn from history if we do not

It is easy to see historical people as fundamentally different from ourselves. It is hard to learn from history if we believe their lives were so different  -->
<p>I love the website <a href="https://quoteinvestigator.com/">Quote Investigator</a>. Author Garson O‚ÄôToole has performed careful research to track down the true origin of over 2,000 user submitted quotes. While browsing the site, I noticed that many misattributed quotes had a similar style, while actual historical quotes were much more varied in word choice and phrasing.<sup>1</sup> I wanted to train a model along the lines of this intuition. Ideally, the model could serve as a first pass on a quote‚Äôs legitimacy. To accomplish this, I built a natural language processing model that predicts a quote author‚Äôs gender, birth year, and occupation. First, I web-scraped 230k quotes from Wikiquote and data on 12k authors from Wikimedia. Next, I built a PyTorch model using a BERT encoding backbone and multiple prediction heads. Then, I trained the model on remote GPUs and monitored performance with Weights and Biases. Finally, I deployed the model with an interactive UI via Gradio and Hugging Face Spaces.</p>
<p>The first step in learning from history is to recognize our shared humanity with the past. A good quote can help bridge the gap to past generations and lead us to see the applicability of their experience. A misattributed quote can often do the opposite. It may further the mythicization of historical figures and, consequently, their irrelevance.</p>
<!-- A misattributed quote, however, often does the opposite. 


The best way to tell whether a quote is misattributed is to Google it.

I wanted to see whether a deep learning model could make reasonable predictions about an author's birth year and occupation based on a singl 

I wanted to build a model that predicts certain attributes of the author 



In doing so, he humanizes the past. Learning from history requires acknowledging that humans have not changed much in the past few thousand years, and the challenges that historical figures faced are not too dissimilar to the ones we face today.  


Many misattributed quotes work to mythologize historical figures by playing into established chara

 Overcoming this misconception is necessary to learn from history. -->
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<section id="data-scraping" class="level3">
<h3 class="anchored" data-anchor-id="data-scraping">Data Scraping</h3>
<p>Quotes were scraped from <a href="https://en.wikiquote.org/wiki/Main_Page">Wikiquote</a>. Wikiquote was selected over the popular <a href="https://www.kaggle.com/datasets/akmittal/quotes-dataset">Goodreads</a> dataset for two reasons: first, Wikiquote provides a Wikimedia ID, allowing accurate author-attribute matching; second, Goodreads has many misattributed quotes, which runs counter to the original motivation.</p>
<p>I used <a href="https://beautiful-soup-4.readthedocs.io/en/latest/">BeautifulSoup</a> to scrape Wikiquote. I first collected individual profile links by iterating through an index of people by name. Then, I scraped text from the <em>edit</em> page instead of the primary page because the edit page was more easily parsable. The code for the scraping is below.</p>
<div id="66c515b8" class="cell">
<details class="code-fold">
<summary>Wikiquote scraping code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================</span></span>
<span id="cb1-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># First collect all page links</span></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================</span></span>
<span id="cb1-4"></span>
<span id="cb1-5">BASE_URL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://en.wikiquote.org"</span></span>
<span id="cb1-6">START_URL <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>BASE_URL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">/wiki/List_of_people_by_name"</span></span>
<span id="cb1-7">EDIT_URL_TEMPLATE <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://en.wikiquote.org/w/index.php?title=</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{}</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">&amp;action=edit"</span></span>
<span id="cb1-8">PEOPLE_LINK_PATH <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/scraped_data/people_edit_links.txt"</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> get_people_links(url):</span>
<span id="cb1-12">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Extracts and returns (name, title) pairs from a Wikiquote page.</span></span>
<span id="cb1-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Title is the formatted page name.</span></span>
<span id="cb1-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb1-15">    headers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {}  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Write header here</span></span>
<span id="cb1-16">    response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(url, headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>headers)</span>
<span id="cb1-17">    response.raise_for_status()</span>
<span id="cb1-18"></span>
<span id="cb1-19">    soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(response.text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb1-20">    people_links <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>()</span>
<span id="cb1-21"></span>
<span id="cb1-22">    content_div <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"div"</span>, {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"id"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mw-content-text"</span>})</span>
<span id="cb1-23"></span>
<span id="cb1-24">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> content_div:</span>
<span id="cb1-25">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"No content found in </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> people_links</span>
<span id="cb1-27"></span>
<span id="cb1-28">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> a_tag <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> content_div.find_all(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, href<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>):</span>
<span id="cb1-29">        href <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a_tag[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"href"</span>]</span>
<span id="cb1-30">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> href.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/wiki/"</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">any</span>(</span>
<span id="cb1-31">            prefix <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> href <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> prefix <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">":"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#"</span>]</span>
<span id="cb1-32">        ):</span>
<span id="cb1-33">            title <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> href.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/wiki/"</span>)[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb1-34">            name <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> a_tag.get_text(strip<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb1-35">            people_links.add((name, title))  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># store as tuple (name, title)</span></span>
<span id="cb1-36"></span>
<span id="cb1-37">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> people_links</span>
<span id="cb1-38"></span>
<span id="cb1-39"></span>
<span id="cb1-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> collect_wikiquotes_edit_links():</span>
<span id="cb1-41">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Collecting links from </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>START_URL<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb1-42">    people_pairs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_people_links(START_URL)</span>
<span id="cb1-43"></span>
<span id="cb1-44">    additional_pairs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>()</span>
<span id="cb1-45">    final_pairs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>()</span>
<span id="cb1-46"></span>
<span id="cb1-47">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> name, title <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>(people_pairs):</span>
<span id="cb1-48">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"List_of_people_by_name"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> title:</span>
<span id="cb1-49">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Handle index pages: Add their links to the queue for further processing</span></span>
<span id="cb1-50">            link <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> urljoin(BASE_URL, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/wiki/"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> title)</span>
<span id="cb1-51">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Checking additional page: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>link<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-52">            time.sleep(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb1-53">            more_pairs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_people_links(link)</span>
<span id="cb1-54">            additional_pairs.update(more_pairs)</span>
<span id="cb1-55">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-56">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Handle individual pages: Add them to the final output</span></span>
<span id="cb1-57">            final_pairs.add((name, title))</span>
<span id="cb1-58"></span>
<span id="cb1-59">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Combine all links from additional pages, excluding index pages</span></span>
<span id="cb1-60">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> name, title <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> additional_pairs:</span>
<span id="cb1-61">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"List_of_people_by_name"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> title:</span>
<span id="cb1-62">            final_pairs.add((name, title))</span>
<span id="cb1-63"></span>
<span id="cb1-64">    edit_urls <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb1-65">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(PEOPLE_LINK_PATH, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb1-66">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> name, title <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sorted</span>(final_pairs, key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>]):  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># sort by name</span></span>
<span id="cb1-67">            edit_url <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> EDIT_URL_TEMPLATE.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">format</span>(title)</span>
<span id="cb1-68">            edit_urls.append(edit_url)</span>
<span id="cb1-69">            f.write(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>edit_url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># write name and edit URL separated by tab</span></span>
<span id="cb1-70"></span>
<span id="cb1-71">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Collected </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(edit_urls)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> unique edit URLs."</span>)</span>
<span id="cb1-72"></span>
<span id="cb1-73"></span>
<span id="cb1-74"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read the file and parse it into a list of tuples</span></span>
<span id="cb1-75"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># PEOPLE_LINK_PATH = "data\\scraped_data\\people_edit_links.txt"</span></span>
<span id="cb1-76"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> os.path.exists(PEOPLE_LINK_PATH):</span>
<span id="cb1-77">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">pass</span></span>
<span id="cb1-78"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb1-79">    collect_wikiquotes_edit_links()</span>
<span id="cb1-80"></span>
<span id="cb1-81"></span>
<span id="cb1-82"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(PEOPLE_LINK_PATH, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"r"</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>:</span>
<span id="cb1-83">    people_edit_links <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">tuple</span>(line.strip().split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\t</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> line <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">file</span>]</span>
<span id="cb1-84">names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> people_edit_links]</span>
<span id="cb1-85">urls <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> people_edit_links]</span>
<span id="cb1-86"></span>
<span id="cb1-87"></span>
<span id="cb1-88"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================</span></span>
<span id="cb1-89"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Now, parse each edit page</span></span>
<span id="cb1-90"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># ==============================</span></span>
<span id="cb1-91"></span>
<span id="cb1-92"></span>
<span id="cb1-93"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> query_wikiquote(url: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> BeautifulSoup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb1-94">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Takes an edit-page URL and returns a BeautifulSoup object."""</span></span>
<span id="cb1-95">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># parse and extract quotes</span></span>
<span id="cb1-96">    headers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header here"</span>}</span>
<span id="cb1-97">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb1-98">        response <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> requests.get(url, headers<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>headers, timeout<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>)</span>
<span id="cb1-99">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>:</span>
<span id="cb1-100">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Failed to fetch the page (likely timeout): </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb1-101">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-102"></span>
<span id="cb1-103">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> response.status_code <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">200</span>:</span>
<span id="cb1-104">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Failed to fetch the page."</span>)</span>
<span id="cb1-105">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb1-106"></span>
<span id="cb1-107">    soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BeautifulSoup(response.text, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"html.parser"</span>)</span>
<span id="cb1-108"></span>
<span id="cb1-109">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> soup</span>
<span id="cb1-110"></span>
<span id="cb1-111"></span>
<span id="cb1-112"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> extract_textarea(soup: BeautifulSoup) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb1-113">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Extracts the textarea content from the BeautifulSoup object."""</span></span>
<span id="cb1-114">    textarea <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"textarea"</span>, {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wpTextbox1"</span>})</span>
<span id="cb1-115"></span>
<span id="cb1-116">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> textarea:</span>
<span id="cb1-117">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Couldn't find the textarea."</span>)</span>
<span id="cb1-118">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb1-119"></span>
<span id="cb1-120">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> textarea.text</span>
<span id="cb1-121"></span>
<span id="cb1-122"></span>
<span id="cb1-123"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> extract_wikimedia_id(soup: BeautifulSoup) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb1-124">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Extracts the Wikimedia ID from the soup object."""</span></span>
<span id="cb1-125">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the &lt;a&gt; tag with the desired href</span></span>
<span id="cb1-126">    link <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> soup.find(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, class_<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"extiw wb-entity-link external"</span>)</span>
<span id="cb1-127">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the Q-number from the href attribute</span></span>
<span id="cb1-128">    q_number <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb1-129">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> link <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"href"</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> link.attrs:</span>
<span id="cb1-130">        href <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> link[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"href"</span>]</span>
<span id="cb1-131">        q_number <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> href.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/"</span>)[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract the last part of the URL</span></span>
<span id="cb1-132">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> q_number</span>
<span id="cb1-133"></span>
<span id="cb1-134"></span>
<span id="cb1-135">output_csv <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/scraped_data/wikiquotes_scraped.csv"</span>)</span>
<span id="cb1-136">seen_names <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>()</span>
<span id="cb1-137"></span>
<span id="cb1-138"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This loop was necessary to resume scraping after interruptions</span></span>
<span id="cb1-139"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">while</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(seen_names) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(names):</span>
<span id="cb1-140">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if the file exists to determine whether to write the header</span></span>
<span id="cb1-141">    file_exists <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.isfile(output_csv)</span>
<span id="cb1-142"></span>
<span id="cb1-143">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> file_exists:</span>
<span id="cb1-144">        scraped_data <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(output_csv, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>)</span>
<span id="cb1-145">        seen_names.update(scraped_data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].tolist())</span>
<span id="cb1-146"></span>
<span id="cb1-147">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(output_csv, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"a"</span>, newline<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> csvfile:</span>
<span id="cb1-148">        fieldnames <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_id"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_text"</span>]</span>
<span id="cb1-149">        writer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> csv.DictWriter(csvfile, fieldnames<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>fieldnames, quoting<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>csv.QUOTE_ALL)</span>
<span id="cb1-150">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> file_exists:</span>
<span id="cb1-151">            writer.writeheader()</span>
<span id="cb1-152"></span>
<span id="cb1-153">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> name, url <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(names, urls):</span>
<span id="cb1-154">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> name <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> seen_names:</span>
<span id="cb1-155">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Skipping </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> as it has already been processed."</span>)</span>
<span id="cb1-156">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span></span>
<span id="cb1-157">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Processing </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> from </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>url<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">..."</span>)</span>
<span id="cb1-158">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> url.startswith(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://en.wikiquote.org/w/index.php?title="</span>):</span>
<span id="cb1-159">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Skipping </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> as the URL is not an edit page."</span>)</span>
<span id="cb1-160">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span></span>
<span id="cb1-161">            soup <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> query_wikiquote(url)</span>
<span id="cb1-162">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> soup <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb1-163">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Skipping </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>name<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> due to query failure."</span>)</span>
<span id="cb1-164">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">continue</span></span>
<span id="cb1-165">            wikimedia_id <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_wikimedia_id(soup)</span>
<span id="cb1-166">            raw_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> extract_textarea(soup)</span>
<span id="cb1-167">            writer.writerow(</span>
<span id="cb1-168">                {<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>: name, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_id"</span>: wikimedia_id, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_text"</span>: raw_text},</span>
<span id="cb1-169">            )</span>
<span id="cb1-170">            time.sleep(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>)</span>
<span id="cb1-171"></span>
<span id="cb1-172">results_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(output_csv, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>)</span>
<span id="cb1-173">wikimedia_ids <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>(results_df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_id"</span>].tolist())</span>
<span id="cb1-174"></span>
<span id="cb1-175">wikimedia_id_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> Path(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/scraped_data/wikimedia_ids.txt"</span>)</span>
<span id="cb1-176"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(wikimedia_id_path, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"w"</span>, encoding<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"utf-8"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb1-177">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> wikimedia_id <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> wikimedia_ids:</span>
<span id="cb1-178">        f.write(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>wikimedia_id<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\n</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span></code></pre></div></div>
</details>
</div>
<p>I accessed <a href="https://www.wikidata.org/wiki/Wikidata:Main_Page">Wikidata</a> through their API. I retrieved data on each author‚Äôs birth year, death year, occupation, nationality, gender, and average monthly page views.</p>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h3>
<p>Owing to the crowdsourced nature of Wikiquote, the initial data pull was <em>very</em> messy. I performed the following processing steps:</p>
<ol type="1">
<li>Parse individual quotes and their associated headers from the full edit text. Recording the header was necessary because many pages include a ‚ÄúMisattributed‚Äù or ‚ÄúQuotes About [Person]‚Äù section that should be filtered.</li>
<li>Mark bolded quote segments. Many Wikiquote entries include a memorable bolded quote alongside significant context. I recorded and marked the bolded fragments for later processing.</li>
<li>Clean common markup artifacts.</li>
<li>Filter non-English quotes.</li>
<li>Perform systematic checks and spot checks to remove other abnormalities from the scraped data, such as external links, specific poorly formatted authors, and quotes with messy headers.</li>
</ol>
<p>Cleaning the author data was much simpler.</p>
<div id="af34b1f8" class="cell">
<details class="code-fold">
<summary>Quote data cleaning</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> text_to_list(text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]:</span>
<span id="cb2-2">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parse markdown text into a list of section headers and quotes.</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Finds all strings that begin with "=" (section headers) or "*" (quotes).</span></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-6">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> re.findall(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">^</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[=*]</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">$</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, text, re.MULTILINE)</span>
<span id="cb2-7"></span>
<span id="cb2-8"></span>
<span id="cb2-9"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> quotes_from_list(section_headers_and_quotes: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>]:</span>
<span id="cb2-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extract quotes with their associated metadata from parsed text.</span></span>
<span id="cb2-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Processes a list of headers and quotes, organizing them into dictionaries</span></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    with header, subheader, and notes information.</span></span>
<span id="cb2-14"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-15">    header <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb2-16">    subheader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span></span>
<span id="cb2-17">    recorded_quotes: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-18">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> dirty <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> section_headers_and_quotes:</span>
<span id="cb2-19">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Headers</span></span>
<span id="cb2-20">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> re.match(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">^</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">==</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^=]</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^=]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">==</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">$</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, dirty):</span>
<span id="cb2-21">            header <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dirty.strip(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"= "</span>)</span>
<span id="cb2-22">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Subheaders</span></span>
<span id="cb2-23">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> re.match(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">^</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">===</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^=]</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^=]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">===</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">$</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, dirty):</span>
<span id="cb2-24">            subheader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> dirty.strip(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"= "</span>)</span>
<span id="cb2-25">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Quotes</span></span>
<span id="cb2-26">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> re.match(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">^</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\*\*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^*]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, dirty):</span>
<span id="cb2-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> recorded_quotes:</span>
<span id="cb2-28">                recorded_quotes[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>][<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>].append(dirty.strip(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"* "</span>))</span>
<span id="cb2-29">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> re.match(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">^</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\*</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^*]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, dirty):</span>
<span id="cb2-30">            quote_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb2-31">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_quote"</span>: dirty.strip(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"* "</span>),</span>
<span id="cb2-32">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>: header,</span>
<span id="cb2-33">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subheader"</span>: subheader,</span>
<span id="cb2-34">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>: [],</span>
<span id="cb2-35">            }</span>
<span id="cb2-36">            recorded_quotes.append(quote_dict)</span>
<span id="cb2-37">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> recorded_quotes</span>
<span id="cb2-38"></span>
<span id="cb2-39"></span>
<span id="cb2-40"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> join_fragments(fragments: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>], original_text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb2-41">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Join bolded quote fragments with appropriate separators.</span></span>
<span id="cb2-43"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Combines multiple bolded subsections into a single quote, using different</span></span>
<span id="cb2-44"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    separators based on whether fragments are part of the same sentence.</span></span>
<span id="cb2-45"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-46">    result <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-47">    last_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb2-48"></span>
<span id="cb2-49">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> i, fragment <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(fragments):</span>
<span id="cb2-50">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> i <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb2-51">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Find the text between the last bold fragment and the current one</span></span>
<span id="cb2-52">            start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> original_text.find(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"'''</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>fragment<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'''"</span>, last_end)</span>
<span id="cb2-53">            in_between_text <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> original_text[last_end:start]</span>
<span id="cb2-54">            last_end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"'''</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>fragment<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">'''"</span>)</span>
<span id="cb2-55"></span>
<span id="cb2-56">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Check if the in-between text contains a sentence-ending punctuation</span></span>
<span id="cb2-57">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> re.search(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[.!?]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, in_between_text) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> re.search(</span>
<span id="cb2-58">                <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[.!?]</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">$</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, result[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>]</span>
<span id="cb2-59">            ):</span>
<span id="cb2-60">                result.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" .... "</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Different sentence</span></span>
<span id="cb2-61">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb2-62">                result.append(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" ... "</span>)  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Same sentence</span></span>
<span id="cb2-63"></span>
<span id="cb2-64">        result.append(fragment)</span>
<span id="cb2-65">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>.join(result)</span>
<span id="cb2-66"></span>
<span id="cb2-67"></span>
<span id="cb2-68"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> parse_to_bold(q_dict: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>]:</span>
<span id="cb2-69">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-70"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Extract and mark bolded quote sections.</span></span>
<span id="cb2-71"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Creates separate entries for complete quotes and their bolded fragments,</span></span>
<span id="cb2-72"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    with flags indicating whether text is bolded.</span></span>
<span id="cb2-73"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-74"></span>
<span id="cb2-75">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> fill_dict(</span>
<span id="cb2-76">        quote_to_add: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, orig_dict: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>, bold_fragment: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>, bold_combined: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span></span>
<span id="cb2-77">    ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb2-78">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Helper function to create quote dictionary with bold metadata."""</span></span>
<span id="cb2-79">        bold <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> bold_fragment <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">or</span> bold_combined</span>
<span id="cb2-80">        quote_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb2-81">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_quote"</span>: quote_to_add,</span>
<span id="cb2-82">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_complete_quote"</span>: orig_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_quote"</span>],</span>
<span id="cb2-83">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold"</span>: bold,</span>
<span id="cb2-84">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold_fragment"</span>: bold_fragment,</span>
<span id="cb2-85">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold_combined"</span>: bold_combined,</span>
<span id="cb2-86">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>: q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>],</span>
<span id="cb2-87">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subheader"</span>: q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subheader"</span>],</span>
<span id="cb2-88">            <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>: q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>],</span>
<span id="cb2-89">        }</span>
<span id="cb2-90">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> quote_dict</span>
<span id="cb2-91"></span>
<span id="cb2-92">    recorded_with_bold: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-93">    quote <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_quote"</span>]</span>
<span id="cb2-94">    quote_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fill_dict(quote, q_dict, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb2-95">    recorded_with_bold.append(quote_dict)</span>
<span id="cb2-96">    bold_fragments <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.findall(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"'''</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*?</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">'''"</span>, quote)</span>
<span id="cb2-97"></span>
<span id="cb2-98">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># If there are multiple bold sections, add them separately and combined</span></span>
<span id="cb2-99">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(bold_fragments) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb2-100">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add the combined quote</span></span>
<span id="cb2-101">        combined_fragments <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> join_fragments(bold_fragments, quote)</span>
<span id="cb2-102">        quote_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fill_dict(combined_fragments, q_dict, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-103">        recorded_with_bold.append(quote_dict)</span>
<span id="cb2-104">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> bold_fragment <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> bold_fragments:</span>
<span id="cb2-105">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add each fragment independently</span></span>
<span id="cb2-106">            quote_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fill_dict(bold_fragment, q_dict, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb2-107">            recorded_with_bold.append(quote_dict)</span>
<span id="cb2-108"></span>
<span id="cb2-109">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Add single bolded section</span></span>
<span id="cb2-110">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(bold_fragments) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>:</span>
<span id="cb2-111">        quote_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> fill_dict(bold_fragments[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>], q_dict, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-112">        recorded_with_bold.append(quote_dict)</span>
<span id="cb2-113"></span>
<span id="cb2-114">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> recorded_with_bold</span>
<span id="cb2-115"></span>
<span id="cb2-116"></span>
<span id="cb2-117"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> cleaner(dirty: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>:</span>
<span id="cb2-118">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-119"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Remove common markup formatting from text.</span></span>
<span id="cb2-120"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Strips wiki markup, HTML tags, special characters, and extra whitespace</span></span>
<span id="cb2-121"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    while preserving basic punctuation and readability.</span></span>
<span id="cb2-122"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-123">    dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb2-124">        dirty.replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"'''"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb2-125">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"''"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb2-126">        .strip(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"*"</span>)</span>
<span id="cb2-127">        .lstrip()</span>
<span id="cb2-128">        .replace(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"[[w:"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)</span>
<span id="cb2-129">    )</span>
<span id="cb2-130">    dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"&lt;br&gt;"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, dirty)</span>
<span id="cb2-131">    dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"{{</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*?</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">}}"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, dirty)</span>
<span id="cb2-132">    dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"&lt;/</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">?</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^&gt;]</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">&gt;"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, dirty)</span>
<span id="cb2-133">    dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\|</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">.</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*?</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\]\]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, dirty)</span>
<span id="cb2-134">    dirty <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(</span>
<span id="cb2-135">        <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">[^0-9A-Za-z</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\.</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">,</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\?</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">!:;</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\'\"\(\)\-\u2013\u2014\/\u2018\u2019\u201c\u201d\u2026</span><span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">&amp;]</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb2-136">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb2-137">        dirty,</span>
<span id="cb2-138">    )</span>
<span id="cb2-139">    clean <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> re.sub(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" "</span>, dirty).strip()</span>
<span id="cb2-140">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> clean</span>
<span id="cb2-141"></span>
<span id="cb2-142"></span>
<span id="cb2-143"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> clean_bold_dict(input_dict: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>:</span>
<span id="cb2-144">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-145"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Apply cleaner function to all text fields in quote dictionary.</span></span>
<span id="cb2-146"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-147">    q_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> input_dict.copy()</span>
<span id="cb2-148"></span>
<span id="cb2-149">    q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaner(q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>])</span>
<span id="cb2-150">    q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subheader"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaner(q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subheader"</span>])</span>
<span id="cb2-151">    cleaned_notes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-152">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> note <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>]:</span>
<span id="cb2-153">        cleaned_notes.append(cleaner(note))</span>
<span id="cb2-154">    q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"notes"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaned_notes</span>
<span id="cb2-155"></span>
<span id="cb2-156">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_quote"</span>]:</span>
<span id="cb2-157">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> q_dict</span>
<span id="cb2-158">    q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_quote"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaner(q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_quote"</span>])</span>
<span id="cb2-159">    q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_complete_quote"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> cleaner(q_dict[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_complete_quote"</span>])</span>
<span id="cb2-160"></span>
<span id="cb2-161">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> q_dict</span>
<span id="cb2-162"></span>
<span id="cb2-163"></span>
<span id="cb2-164"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> page_pipeline(text: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>]:</span>
<span id="cb2-165">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-166"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Complete processing pipeline for a Wikiquote page.</span></span>
<span id="cb2-167"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Parses raw edit page text through all cleaning and processing steps</span></span>
<span id="cb2-168"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    to extract structured quote data.</span></span>
<span id="cb2-169"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-170">    section_headers_and_quotes: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> text_to_list(text)</span>
<span id="cb2-171">    quote_dicts: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> quotes_from_list(section_headers_and_quotes)</span>
<span id="cb2-172">    cleaned_bold_dicts: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb2-173">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> q_dict <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> quote_dicts:</span>
<span id="cb2-174">        bold_dicts: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> parse_to_bold(q_dict)</span>
<span id="cb2-175">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> bold <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> bold_dicts:</span>
<span id="cb2-176">            cleaned_bold: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> clean_bold_dict(bold)</span>
<span id="cb2-177">            cleaned_bold_dicts.append(cleaned_bold)</span>
<span id="cb2-178">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> cleaned_bold_dicts</span>
<span id="cb2-179"></span>
<span id="cb2-180"></span>
<span id="cb2-181"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Read raw scraped data</span></span>
<span id="cb2-182">csv_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> os.path.join(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scraped_data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikiquotes_scraped.csv"</span>)</span>
<span id="cb2-183">raw_quotes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(csv_path)</span>
<span id="cb2-184"></span>
<span id="cb2-185"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Apply the pipeline and explode the results into a new DataFrame</span></span>
<span id="cb2-186">processed <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> raw_quotes.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb2-187">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> row: [</span>
<span id="cb2-188">        {<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>elem, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_id"</span>: row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_id"</span>], <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>: row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>]}</span>
<span id="cb2-189">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> elem <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> page_pipeline(row[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw_text"</span>])</span>
<span id="cb2-190">    ],</span>
<span id="cb2-191">    axis<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb2-192">)</span>
<span id="cb2-193"></span>
<span id="cb2-194"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Flatten the list of lists and create a DataFrame</span></span>
<span id="cb2-195">flat_list <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [item <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> sublist <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> processed <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> sublist]</span>
<span id="cb2-196">quotes_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.DataFrame(flat_list)</span>
<span id="cb2-197"></span>
<span id="cb2-198"></span>
<span id="cb2-199"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> filter_about(df: pd.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-200">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-201"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Filter out quotes about people rather than by them.</span></span>
<span id="cb2-202"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Removes sections containing quotes discussing a person rather than</span></span>
<span id="cb2-203"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    quotes spoken or written by that person.</span></span>
<span id="cb2-204"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-205">    about_filter <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">^\s</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">(</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">Quotations regarding Spinoza</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">Song lyrics about Lars Ulrich</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">Film directors about</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">Some more interesting facts about Mukesh Ambani</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">Comments About</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">Quotes from stars</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">quotes about</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">quotations about</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">about</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">quotes of others</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">quotations of others</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">quotes from others</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">quotes by others</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">quotation about</span><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">|</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">said about</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">)</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span></span>
<span id="cb2-206">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(about_filter, case<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, na<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)]</span>
<span id="cb2-207"></span>
<span id="cb2-208"></span>
<span id="cb2-209"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> filter_external_links(df: pd.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-210">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-211"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Remove external links and 'See also' sections.</span></span>
<span id="cb2-212"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-213">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"External links"</span>]</span>
<span id="cb2-214">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"See also"</span>]</span>
<span id="cb2-215">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb2-216"></span>
<span id="cb2-217"></span>
<span id="cb2-218"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> filter_works(df: pd.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-219">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-220"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Remove pages that contain works instead of quotes.</span></span>
<span id="cb2-221"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Filters out entries where the content is primarily a list of works</span></span>
<span id="cb2-222"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    rather than actual quotations, with specific exceptions.</span></span>
<span id="cb2-223"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-224">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[</span>
<span id="cb2-225">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.contains(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"work"</span>, case<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>, na<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb2-226">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>].isin(</span>
<span id="cb2-227">            [</span>
<span id="cb2-228">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Malek, Marcin"</span>,</span>
<span id="cb2-229">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Kok, Ingrid de"</span>,</span>
<span id="cb2-230">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Maharaj, Nisargadatta"</span>,</span>
<span id="cb2-231">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Rice, Tim"</span>,</span>
<span id="cb2-232">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Waberi, Abdourahman"</span>,</span>
<span id="cb2-233">            ]</span>
<span id="cb2-234">        )</span>
<span id="cb2-235">    ]</span>
<span id="cb2-236">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb2-237"></span>
<span id="cb2-238"></span>
<span id="cb2-239"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> filter_fragments(</span>
<span id="cb2-240">    df: pd.DataFrame, full_cutoff: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">3</span>, bold_cutoof: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span></span>
<span id="cb2-241">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-242">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-243"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Remove quote fragments that are too short.</span></span>
<span id="cb2-244"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Filters quotes with fewer than 3 words, or fewer than 5 words for</span></span>
<span id="cb2-245"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    bold fragments which tend to be shorter memorable phrases.</span></span>
<span id="cb2-246"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-247">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[</span>
<span id="cb2-248">        <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span>(</span>
<span id="cb2-249">            (df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_quote"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.split().<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> full_cutoff)</span>
<span id="cb2-250">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> (</span>
<span id="cb2-251">                (df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"bold_fragment"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-252">                <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> (df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_quote"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.split().<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>() <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&lt;</span> bold_cutoof)</span>
<span id="cb2-253">            )</span>
<span id="cb2-254">        )</span>
<span id="cb2-255">    ]</span>
<span id="cb2-256">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb2-257"></span>
<span id="cb2-258"></span>
<span id="cb2-259"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> filter_starting_numbers(df: pd.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-260">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-261"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Remove leading numbers and periods from quotes.</span></span>
<span id="cb2-262"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-263">    df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_quote"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_quote"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>.replace(<span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">r"</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">^\d</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span><span class="ch" style="color: #20794D;
background-color: null;
font-style: inherit;">\.</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">\s</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span><span class="vs" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>, regex<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-264">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb2-265"></span>
<span id="cb2-266"></span>
<span id="cb2-267"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> filter_non_string(df: pd.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-268">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-269"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Remove entries where clean_quote is not a string.</span></span>
<span id="cb2-270"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-271">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df[df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_quote"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(<span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(x, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>))]</span>
<span id="cb2-272"></span>
<span id="cb2-273"></span>
<span id="cb2-274"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_misattributed_column(df: pd.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-275">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-276"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Add boolean column indicating misattributed or disputed quotes.</span></span>
<span id="cb2-277"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Marks quotes from 'Misattributed' or 'Disputed' sections.</span></span>
<span id="cb2-278"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-279">    df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"misattributed"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"header"</span>].isin([<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Misattributed"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Disputed"</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> (</span>
<span id="cb2-280">        df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"subheader"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Misattributed"</span></span>
<span id="cb2-281">    )</span>
<span id="cb2-282">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb2-283"></span>
<span id="cb2-284"></span>
<span id="cb2-285"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_is_en_col(df: pd.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-286">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-287"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Add boolean column indicating whether quote is in English.</span></span>
<span id="cb2-288"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Uses langdetect library to identify English quotes.</span></span>
<span id="cb2-289"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-290"></span>
<span id="cb2-291">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> detect_language(text):</span>
<span id="cb2-292">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Detect if text is English, handling exceptions."""</span></span>
<span id="cb2-293">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(text, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>):</span>
<span id="cb2-294">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb2-295">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb2-296">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> detect(text) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"en"</span></span>
<span id="cb2-297">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> LangDetectException:</span>
<span id="cb2-298">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb2-299"></span>
<span id="cb2-300">    amended <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy(deep<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb2-301">    amended[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"is_en"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> amended[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"clean_quote"</span>].progress_apply(detect_language)</span>
<span id="cb2-302"></span>
<span id="cb2-303">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> amended</span>
<span id="cb2-304"></span>
<span id="cb2-305"></span>
<span id="cb2-306"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> filter_pipeline(df: pd.DataFrame) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb2-307">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb2-308"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Apply all filtering and processing steps to quote DataFrame.</span></span>
<span id="cb2-309"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Runs the complete sequence of filters to produce a clean dataset</span></span>
<span id="cb2-310"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    ready for model training.</span></span>
<span id="cb2-311"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    """</span></span>
<span id="cb2-312">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> filter_about(df)</span>
<span id="cb2-313">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> filter_external_links(df)</span>
<span id="cb2-314">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> filter_works(df)</span>
<span id="cb2-315">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> filter_fragments(df)</span>
<span id="cb2-316">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> filter_starting_numbers(df)</span>
<span id="cb2-317">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> filter_non_string(df)</span>
<span id="cb2-318">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> add_misattributed_column(df)</span>
<span id="cb2-319">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> add_is_en_col(df)</span>
<span id="cb2-320">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb2-321"></span>
<span id="cb2-322"></span>
<span id="cb2-323">quotes_df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> filter_pipeline(quotes_df)</span></code></pre></div></div>
</details>
</div>
<div id="8f79cf48" class="cell">
<details class="code-fold">
<summary>Author data cleaning</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> split_lowercase_list(df: pd.DataFrame, column: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-2">    df[column] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[column].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb3-3">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: [item.strip().lower() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> item <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> x.split(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>)] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pd.notna(x) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> x</span>
<span id="cb3-4">    )</span>
<span id="cb3-5">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb3-6"></span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> replace_empty_list_with_null(df: pd.DataFrame, column: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-9">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb3-10">    df[column] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[column].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb3-11">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: np.nan <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(x, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> x <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> x</span>
<span id="cb3-12">    )</span>
<span id="cb3-13">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb3-14"></span>
<span id="cb3-15"></span>
<span id="cb3-16"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> limit_by_frequency(</span>
<span id="cb3-17">    df: pd.DataFrame, column: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, min_freq: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, suffix: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_limited"</span></span>
<span id="cb3-18">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-19">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Creates a new column that only includes values with at least `min_freq` occurrences."""</span></span>
<span id="cb3-20">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb3-21">    val_counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.Series([x <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> y <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> df[column].dropna() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> y]).value_counts()</span>
<span id="cb3-22">    vals_above_min <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val_counts[val_counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> min_freq].index.tolist()</span>
<span id="cb3-23">    df[column <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> suffix] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[column].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb3-24">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> lst: (</span>
<span id="cb3-25">            [val <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> lst <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> vals_above_min]</span>
<span id="cb3-26">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(lst, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>)</span>
<span id="cb3-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> lst</span>
<span id="cb3-28">        )</span>
<span id="cb3-29">    )</span>
<span id="cb3-30">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb3-31"></span>
<span id="cb3-32"></span>
<span id="cb3-33"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> limit_by_top_k(</span>
<span id="cb3-34">    df: pd.DataFrame, column: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, k: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, suffix: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_limited"</span></span>
<span id="cb3-35">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-36">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""Creates a new column that only includes values in the list of the top-k most frequent values."""</span></span>
<span id="cb3-37">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb3-38">    val_counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.Series([x <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> y <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> df[column].dropna() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> x <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> y]).value_counts()</span>
<span id="cb3-39">    top_k_vals <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val_counts.head(k).index.tolist()</span>
<span id="cb3-40">    df[column <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> suffix] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[column].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb3-41">        <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> lst: (</span>
<span id="cb3-42">            [val <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> lst <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> top_k_vals] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(lst, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> lst</span>
<span id="cb3-43">        )</span>
<span id="cb3-44">    )</span>
<span id="cb3-45">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb3-46"></span>
<span id="cb3-47"></span>
<span id="cb3-48"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> replace_val(</span>
<span id="cb3-49">    df: pd.DataFrame, column: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, val, replace_with: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.nan</span>
<span id="cb3-50">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-51">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb3-52">    df[column].replace(val, replace_with)</span>
<span id="cb3-53">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb3-54"></span>
<span id="cb3-55"></span>
<span id="cb3-56"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> create_limited_dummies(</span>
<span id="cb3-57">    df: pd.DataFrame, column: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, vals: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>, suffix: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_dummy"</span></span>
<span id="cb3-58">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-59">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb3-60">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> vals:</span>
<span id="cb3-61">        df[column <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> suffix <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> val] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (df[column] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> val).astype(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb3-62">    df.loc[df[column].isna()] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.nan</span>
<span id="cb3-63">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb3-64"></span>
<span id="cb3-65"></span>
<span id="cb3-66"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> fill_na(df: pd.DataFrame, column: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, func<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>pd.Series.median) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-67">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb3-68">    fill_value <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> func(df[column])</span>
<span id="cb3-69">    df[column] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[column].fillna(fill_value)</span>
<span id="cb3-70">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb3-71"></span>
<span id="cb3-72"></span>
<span id="cb3-73"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> add_log(df: pd.DataFrame, columns: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>]) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-74">    df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.copy()</span>
<span id="cb3-75">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> col <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> columns:</span>
<span id="cb3-76">        df[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"log_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>col<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> np.log(df[col])</span>
<span id="cb3-77"></span>
<span id="cb3-78">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df</span>
<span id="cb3-79"></span>
<span id="cb3-80"></span>
<span id="cb3-81"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> mapping(</span>
<span id="cb3-82">    df: pd.DataFrame,</span>
<span id="cb3-83">    column_name: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>,</span>
<span id="cb3-84">    map_dict: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>],</span>
<span id="cb3-85">    rsuffix: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_mapped"</span>,</span>
<span id="cb3-86">) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-&gt;</span> pd.DataFrame:</span>
<span id="cb3-87"></span>
<span id="cb3-88">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> df.join(df[column_name].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">map</span>(map_dict), rsuffix<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>rsuffix)</span>
<span id="cb3-89"></span>
<span id="cb3-90"></span>
<span id="cb3-91">authors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.read_csv(os.path.join(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scraped_data"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_details.csv"</span>))</span>
<span id="cb3-92">authors <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb3-93">    authors.pipe(split_lowercase_list, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>)</span>
<span id="cb3-94">    .pipe(replace_empty_list_with_null, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>)</span>
<span id="cb3-95">    .pipe(limit_by_top_k, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>, k<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">50</span>)</span>
<span id="cb3-96">    .pipe(replace_val, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"avg_monthly_pageviews"</span>, val<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>, replace_with<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-8</span>)</span>
<span id="cb3-97">    .pipe(create_limited_dummies, column<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span>, vals<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"male"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"female"</span>])</span>
<span id="cb3-98">    .pipe(add_log, columns<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"avg_monthly_pageviews"</span>])</span>
<span id="cb3-99">)</span></code></pre></div></div>
</details>
</div>
</section>
<section id="data-processing-for-training" class="level3">
<h3 class="anchored" data-anchor-id="data-processing-for-training">Data Processing for Training</h3>
<p>Now that I had clean(er) data, it was time to prepare the data for model training. I performed the following steps:</p>
<ol type="1">
<li><em>Create a multi-label target for occupation</em>: Due to Wikidata being crowdsourced, the author data contained hundreds of obscure occupations. To create reasonable targets, I filtered to the 200 most common occupations (dropping 290 of 11,761 authors) and then had &lt;<code>an LLM</code>&gt; categorize occupations. I then manually tweaked categories. I selected this approach over an occupation co-occurrence clustering approach, as the manual method produced more semantically meaningful categories.</li>
<li><em>Create category weights to address occupation skew</em>: The most popular category, <code>Literature &amp; Writing</code>, has 100x as many samples as the least popular category, <code>Athletes &amp; Sports</code>. To address this, I added a scaling factor for occupation categories, defined as <img src="https://latex.codecogs.com/png.latex?%5Ctext%7Bw%7D_i%20=%20%5Cfrac%7B%5Cmax%20w%7D%7B%5Ctext%7Bcount%7D%5E%5Calpha%7D">, where <img src="https://latex.codecogs.com/png.latex?%5Calpha%20%5Cin%20%5B0,%201%5D"> is a scaling hyperparameter. These weights were used to scale loss during backpropagation. A full breakdown of categories, associated quote counts, and weights is provided below.</li>
</ol>
<div id="f433cc31" class="cell">
<details class="code-fold">
<summary>Occupation category mapping</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1">occupation_mapping <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb4-2">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"writer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-3">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"poet"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-4">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"novelist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-5">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"essayist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-6">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"children's writer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-7">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"short story writer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-8">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prose writer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-9">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diarist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-10">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"science fiction writer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-11">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"librettist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-12">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"author"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-13">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"literary scholar"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-14">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"humorist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"journalist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"editor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"columnist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"blogger"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-19">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"opinion journalist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-20">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"television presenter"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-21">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"radio personality"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-22">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"podcaster"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-23">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pundit"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"publisher"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"editing staff"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Journalism &amp; Media"</span>,</span>
<span id="cb4-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"painter"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-27">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sculptor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"photographer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-29">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"illustrator"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-30">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"draftsperson"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-31">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"visual artist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-32">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"printmaker"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-33">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"graphic artist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-34">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"designer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-35">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"architect"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-36">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"architectural draftsperson"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-37">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"fashion designer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-38">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lithographer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-39">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cartoonist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-40">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"comics artist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-41">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"artist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visual Arts &amp; Design"</span>,</span>
<span id="cb4-42">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"singer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-43">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"composer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-44">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"songwriter"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-45">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"singer-songwriter"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-46">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"musician"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-47">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"guitarist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-48">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pianist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-49">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"record producer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-50">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"recording artist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-51">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lyricist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-52">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"conductor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-53">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rapper"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-54">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jazz musician"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-55">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"organist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-56">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"disc jockey"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-57">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"violinist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-58">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"film score composer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-59">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"actor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actor"</span>,</span>
<span id="cb4-60">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"film actor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actor"</span>,</span>
<span id="cb4-61">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"television actor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actor"</span>,</span>
<span id="cb4-62">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"stage actor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actor"</span>,</span>
<span id="cb4-63">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"voice actor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Actor"</span>,</span>
<span id="cb4-64">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"screenwriter"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film &amp; Theater Writer"</span>,</span>
<span id="cb4-65">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"playwright"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film &amp; Theater Writer"</span>,</span>
<span id="cb4-66">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"film director"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-67">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"film producer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-68">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"television producer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-69">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"television director"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-70">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theatrical director"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-71">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"film editor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-72">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"executive producer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-73">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"choreographer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-74">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dramaturge"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-75">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"director"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-76">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"producer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Film, TV, &amp; Theater Production"</span>,</span>
<span id="cb4-77">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"physicist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-78">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theoretical physicist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-79">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"nuclear physicist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-80">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"astrophysicist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-81">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"chemist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-82">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"biologist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-83">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"biochemist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-84">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"zoologist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-85">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"botanist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-86">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geneticist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-87">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geologist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-88">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"astronomer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-89">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"naturalist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-90">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"mathematician"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-91">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"statistician"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-92">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"philosopher"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Humanities"</span>,</span>
<span id="cb4-93">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"historian"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Humanities"</span>,</span>
<span id="cb4-94">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theologian"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Humanities"</span>,</span>
<span id="cb4-95">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"linguist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Humanities"</span>,</span>
<span id="cb4-96">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"classical scholar"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Humanities"</span>,</span>
<span id="cb4-97">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"art historian"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Humanities"</span>,</span>
<span id="cb4-98">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"archaeologist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Humanities"</span>,</span>
<span id="cb4-99">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"economist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Sciences"</span>,</span>
<span id="cb4-100">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sociologist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Sciences"</span>,</span>
<span id="cb4-101">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"psychologist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Sciences"</span>,</span>
<span id="cb4-102">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"political scientist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Sciences"</span>,</span>
<span id="cb4-103">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anthropologist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Sciences"</span>,</span>
<span id="cb4-104">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"geographer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Sciences"</span>,</span>
<span id="cb4-105">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"sociologist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Sciences"</span>,</span>
<span id="cb4-106">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"music theorist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Music"</span>,</span>
<span id="cb4-107">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"university teacher"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-108">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"teacher"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-109">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"professor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-110">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pedagogue"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-111">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lecturer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-112">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"academic"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-113">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"researcher"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-114">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"music educator"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-115">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"librarian"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-116">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"educator"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Academia &amp; Education"</span>,</span>
<span id="cb4-117">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lawyer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Law &amp; Jurisprudence"</span>,</span>
<span id="cb4-118">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"judge"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Law &amp; Jurisprudence"</span>,</span>
<span id="cb4-119">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"jurist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Law &amp; Jurisprudence"</span>,</span>
<span id="cb4-120">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"barrister"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Law &amp; Jurisprudence"</span>,</span>
<span id="cb4-121">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"poet lawyer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Law &amp; Jurisprudence"</span>,</span>
<span id="cb4-122">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"politician"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Politics &amp; Government"</span>,</span>
<span id="cb4-123">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diplomat"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Politics &amp; Government"</span>,</span>
<span id="cb4-124">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"statesperson"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Politics &amp; Government"</span>,</span>
<span id="cb4-125">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"monarch"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Politics &amp; Government"</span>,</span>
<span id="cb4-126">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"civil servant"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Politics &amp; Government"</span>,</span>
<span id="cb4-127">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"theologian"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-128">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"catholic priest"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-129">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"anglican priest"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-130">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rabbi"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-131">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pastor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-132">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"missionary"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-133">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"preacher"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-134">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"religious leader"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-135">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"catholic bishop"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-136">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"minister"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-137">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"christian minister"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-138">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cleric"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-139">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"priest"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Religion"</span>,</span>
<span id="cb4-140">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"businessperson"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Business &amp; Finance"</span>,</span>
<span id="cb4-141">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"entrepreneur"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Business &amp; Finance"</span>,</span>
<span id="cb4-142">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"banker"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Business &amp; Finance"</span>,</span>
<span id="cb4-143">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"merchant"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Business &amp; Finance"</span>,</span>
<span id="cb4-144">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"manufacturer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Business &amp; Finance"</span>,</span>
<span id="cb4-145">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"engineer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Technology"</span>,</span>
<span id="cb4-146">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"computer scientist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Technology"</span>,</span>
<span id="cb4-147">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"programmer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Technology"</span>,</span>
<span id="cb4-148">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inventor"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Technology"</span>,</span>
<span id="cb4-149">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"activist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Advocacy"</span>,</span>
<span id="cb4-150">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"human rights defender"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Advocacy"</span>,</span>
<span id="cb4-151">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"trade unionist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Advocacy"</span>,</span>
<span id="cb4-152">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"peace activist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Advocacy"</span>,</span>
<span id="cb4-153">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"political activist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Advocacy"</span>,</span>
<span id="cb4-154">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"women's rights activist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Advocacy"</span>,</span>
<span id="cb4-155">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"environmentalist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Advocacy"</span>,</span>
<span id="cb4-156">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"revolutionary"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Politics &amp; Government"</span>,</span>
<span id="cb4-157">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"abolitionist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Social Advocacy"</span>,</span>
<span id="cb4-158">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"military personnel"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Military"</span>,</span>
<span id="cb4-159">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"military officer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Military"</span>,</span>
<span id="cb4-160">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"naval officer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Military"</span>,</span>
<span id="cb4-161">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"army officer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Military"</span>,</span>
<span id="cb4-162">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"military leader"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Military"</span>,</span>
<span id="cb4-163">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"soldier"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Military"</span>,</span>
<span id="cb4-164">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"association football player"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Athletes &amp; Sports"</span>,</span>
<span id="cb4-165">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"american football player"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Athletes &amp; Sports"</span>,</span>
<span id="cb4-166">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"basketball player"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Athletes &amp; Sports"</span>,</span>
<span id="cb4-167">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cricketer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Athletes &amp; Sports"</span>,</span>
<span id="cb4-168">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"boxer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Athletes &amp; Sports"</span>,</span>
<span id="cb4-169">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"dancer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Athletes &amp; Sports"</span>,</span>
<span id="cb4-170">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"baseball player"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Athletes &amp; Sports"</span>,</span>
<span id="cb4-171">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"association football coach"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Athletes &amp; Sports"</span>,</span>
<span id="cb4-172">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"literary critic"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-173">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"non-fiction writer"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Literature &amp; Writing"</span>,</span>
<span id="cb4-174">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scientist"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Science &amp; Math"</span>,</span>
<span id="cb4-175">}</span></code></pre></div></div>
</details>
</div>
<div id="2275ecae" class="cell">
<details class="code-fold">
<summary>Quote count and weight by occupation category</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1">counts <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> defaultdict(<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>)</span>
<span id="cb5-2">total_counted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> authors_occupations <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>].dropna():</span>
<span id="cb5-5">    quote_counted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb5-6">    seen_categories <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">set</span>()</span>
<span id="cb5-7">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> occupation <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> authors_occupations:</span>
<span id="cb5-8">        category <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> occupation_mapping.get(occupation)</span>
<span id="cb5-9">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> category <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> category <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> seen_categories:</span>
<span id="cb5-10">            counts[category] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-11">            quote_counted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb5-12">            seen_categories.add(category)</span>
<span id="cb5-13">    total_counted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> quote_counted</span>
<span id="cb5-14"></span>
<span id="cb5-15"><span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> (occupation, count), weight <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">zip</span>(</span>
<span id="cb5-16">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sorted</span>(counts.items(), key<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: x[<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>], reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>),</span>
<span id="cb5-17">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sorted</span>(occupation_weights, reverse<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>),</span>
<span id="cb5-18">):</span>
<span id="cb5-19">    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(</span>
<span id="cb5-20">        <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>occupation<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&lt;30}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>count <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(counts.values())<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;6.1%}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">. </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>weight<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;5.1f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> weight, </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>count<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:&gt;7,.0f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> quotes"</span></span>
<span id="cb5-21">    )</span>
<span id="cb5-22"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span>
<span id="cb5-23"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Literature &amp; Writing          :  23.7%.   1.0 weight, 174,633 quotes</span></span>
<span id="cb5-24"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Politics &amp; Government         :   8.8%.   1.6 weight,  65,293 quotes</span></span>
<span id="cb5-25"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Journalism &amp; Media            :   8.8%.   1.6 weight,  64,734 quotes</span></span>
<span id="cb5-26"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Humanities                    :   8.4%.   1.7 weight,  62,323 quotes</span></span>
<span id="cb5-27"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Academia &amp; Education          :   7.9%.   1.7 weight,  58,063 quotes</span></span>
<span id="cb5-28"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Film &amp; Theater Writer         :   7.1%.   1.8 weight,  52,273 quotes</span></span>
<span id="cb5-29"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Actor                         :   3.9%.   2.5 weight,  28,533 quotes</span></span>
<span id="cb5-30"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Music                         :   3.8%.   2.5 weight,  28,148 quotes</span></span>
<span id="cb5-31"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Social Sciences               :   3.7%.   2.5 weight,  26,948 quotes</span></span>
<span id="cb5-32"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Film, TV, &amp; Theater Production:   3.4%.   2.6 weight,  25,393 quotes</span></span>
<span id="cb5-33"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Science &amp; Math                :   3.4%.   2.6 weight,  25,018 quotes</span></span>
<span id="cb5-34"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Law &amp; Jurisprudence           :   3.2%.   2.7 weight,  23,372 quotes</span></span>
<span id="cb5-35"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Visual Arts &amp; Design          :   3.0%.   2.8 weight,  22,269 quotes</span></span>
<span id="cb5-36"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Social Advocacy               :   2.6%.   3.0 weight,  19,126 quotes</span></span>
<span id="cb5-37"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Religion                      :   2.3%.   3.2 weight,  17,316 quotes</span></span>
<span id="cb5-38"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Military                      :   2.0%.   3.4 weight,  14,946 quotes</span></span>
<span id="cb5-39"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Business &amp; Finance            :   1.8%.   3.7 weight,  12,984 quotes</span></span>
<span id="cb5-40"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Technology                    :   1.5%.   3.9 weight,  11,341 quotes</span></span>
<span id="cb5-41"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">Athletes &amp; Sports             :   0.7%.   5.8 weight,   5,169 quotes</span></span>
<span id="cb5-42"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">"""</span></span></code></pre></div></div>
</details>
</div>
<ol start="3" type="1">
<li><em>Create birth year targets</em>: Ideally, the model would predict when a quote was said. I use the author‚Äôs birth year as a proxy, given the available data. I wanted the birth year target to meet the following constraints:
<ol type="1">
<li>Penalize the same absolute error more when the year is closer to the present day, so that predicting 200 CE for 400 CE is minor, but predicting 1800 CE for 2000 CE is major.</li>
<li>Predict a value with a continuous domain, to enable encoding the continuous development of language. This ruled out binarized approaches.</li>
</ol></li>
</ol>
<p>To achieve these goals, I defined <img src="https://latex.codecogs.com/png.latex?%5Ctext%7BYear%20label%7D=%20%5Clog%20(b-x)%20-%20%5Clog(b-c)">, where <img src="https://latex.codecogs.com/png.latex?c%20=%202025"> (the current year) is used to set the intercept, and <img src="https://latex.codecogs.com/png.latex?b"> is a hyperparameter that determines the steepness of the slope, which captures the relative weight of date differences in the present day vs.&nbsp;the far past. I <img src="https://latex.codecogs.com/png.latex?z">-normalized the converted target.<sup>2</sup></p>
<ol start="4" type="1">
<li><em>Weight quotes by author‚Äôs popularity and number of quotes</em>: There were two problems with the current data. First, the number of quotes per author varies by orders of magnitude. Second, I wanted ‚Äúhigher quality‚Äù authors (as measured by Wikipedia page views) to be upsampled. To achieve this, I set <img src="https://latex.codecogs.com/png.latex?w_%7B%5Ctext%7Bquote%7D%7D%20=%20%5Cfrac%7B%5Clog_2(%5Ctext%7Bauthor%20page%20views%7D)%7D%7B%5Ctext%7Btotal%20author%20quotes%7D%7D">. Authors with missing page view counts were assumed to be missing uniformly at random.</li>
</ol>
<div id="f1d0c97e" class="cell">
<details class="code-fold">
<summary>Birth year target</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1">authors[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year_target"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> authors[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb6-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: np.log((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2050</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> x)) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> np.log((<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2050</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2025</span>)) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pd.notnull(x) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> np.nan</span>
<span id="cb6-3">)</span>
<span id="cb6-4">scaler_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StandardScaler()</span>
<span id="cb6-5">authors[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year_target"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> scaler_fn.fit_transform(authors[[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year_target"</span>]])</span>
<span id="cb6-6"></span>
<span id="cb6-7">df <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pd.merge(</span>
<span id="cb6-8">    quotes, authors, left_on<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_id"</span>, right_on<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikidata_id"</span>, how<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"left"</span></span>
<span id="cb6-9">)</span>
<span id="cb6-10"></span>
<span id="cb6-11">base <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span></span>
<span id="cb6-12">df[<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"log_</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>base<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_views"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"avg_monthly_pageviews"</span>].<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">apply</span>(</span>
<span id="cb6-13">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">lambda</span> x: np.log(x) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> np.log(base) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> pd.notnull(x) <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb6-14">)</span>
<span id="cb6-15">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"num_quotes"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df.groupby(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_id"</span>)[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"wikimedia_id"</span>].transform(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"count"</span>)</span>
<span id="cb6-16">df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"weight"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"log_2_views"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> df[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"num_quotes"</span>]</span></code></pre></div></div>
</details>
</div>
</section>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<section id="model-design" class="level3">
<h3 class="anchored" data-anchor-id="model-design">Model Design</h3>
<p>The model uses a pretrained sentence-embedding model as a backbone. I selected the <a href="https://sbert.net/">Sentence Transformers</a> model <a href="https://huggingface.co/sentence-transformers/all-MiniLM-L6-v2">all-MiniLM-L6-v2</a> because it is lightweight and popular. Encoded quotes are then passed through a set of shared add-on layers, composed of linear, ReLU, and dropout layers. The depth and width of these layers were parameterized. The last shared layer feeds into three prediction heads for gender, year, and occupation.</p>
<div id="c459eb2b" class="cell">
<details class="code-fold">
<summary>PyTorch model class</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> AuthorPredictor(nn.Module):</span>
<span id="cb7-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(</span>
<span id="cb7-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb7-4">        encoder,</span>
<span id="cb7-5">        occupation_classes,</span>
<span id="cb7-6">        device,</span>
<span id="cb7-7">        add_on_layer_dims: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>],</span>
<span id="cb7-8">        dropout_p: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb7-9">        return_embeddings: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb7-10">        extra_occupations_layer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb7-11">        use_hetrosk_year_loss: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb7-12">    ):</span>
<span id="cb7-13">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">super</span>(AuthorPredictor, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>).<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>()</span>
<span id="cb7-14">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.encoder <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> encoder</span>
<span id="cb7-15">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> device</span>
<span id="cb7-16">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dropout <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Dropout(dropout_p)</span>
<span id="cb7-17">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.return_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> return_embeddings</span>
<span id="cb7-18">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.add_on_layer_dims <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> add_on_layer_dims</span>
<span id="cb7-19">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.use_hetrosk_year_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> use_hetrosk_year_loss</span>
<span id="cb7-20">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.occupation_classes <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> occupation_classes</span>
<span id="cb7-21"></span>
<span id="cb7-22">        encoded_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> encoder.config.hidden_size</span>
<span id="cb7-23"></span>
<span id="cb7-24">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> add_on_layer_dims:</span>
<span id="cb7-25">            layers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> []</span>
<span id="cb7-26">            in_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> encoded_dim</span>
<span id="cb7-27">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> out_dim <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> add_on_layer_dims:</span>
<span id="cb7-28">                layers.extend(</span>
<span id="cb7-29">                    [</span>
<span id="cb7-30">                        nn.Linear(in_dim, out_dim),</span>
<span id="cb7-31">                        nn.ReLU(),</span>
<span id="cb7-32">                        nn.Dropout(dropout_p),</span>
<span id="cb7-33">                    ]</span>
<span id="cb7-34">                )</span>
<span id="cb7-35">                in_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> out_dim</span>
<span id="cb7-36"></span>
<span id="cb7-37">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.add_on_layers <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Sequential(<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span>layers)</span>
<span id="cb7-38"></span>
<span id="cb7-39">        latent_dim <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> add_on_layer_dims[<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> add_on_layer_dims <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> encoded_dim</span>
<span id="cb7-40"></span>
<span id="cb7-41">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Prediction heads</span></span>
<span id="cb7-42">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> extra_occupations_layer:</span>
<span id="cb7-43">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.occupation_head <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Sequential(</span>
<span id="cb7-44">                nn.Linear(latent_dim, latent_dim),</span>
<span id="cb7-45">                nn.ReLU(),</span>
<span id="cb7-46">                nn.Dropout(dropout_p),</span>
<span id="cb7-47">                nn.Linear(latent_dim, occupation_classes),</span>
<span id="cb7-48">            )</span>
<span id="cb7-49">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb7-50">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.occupation_head <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(latent_dim, occupation_classes)</span>
<span id="cb7-51"></span>
<span id="cb7-52">        year_out <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> use_hetrosk_year_loss <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb7-53">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.birth_year_head <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(latent_dim, year_out)</span>
<span id="cb7-54">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.gender_head <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> nn.Linear(latent_dim, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb7-55"></span>
<span id="cb7-56">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> forward(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, tokens, attention_mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>):</span>
<span id="cb7-57">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Convert tokens to embeddings</span></span>
<span id="cb7-58">        embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.encoder(</span>
<span id="cb7-59">            tokens, attention_mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>attention_mask</span>
<span id="cb7-60">        ).last_hidden_state[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, :]</span>
<span id="cb7-61"></span>
<span id="cb7-62">        task_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.dropout(embeddings)</span>
<span id="cb7-63"></span>
<span id="cb7-64">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.add_on_layer_dims:</span>
<span id="cb7-65">            task_embeddings <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.add_on_layers(task_embeddings)</span>
<span id="cb7-66"></span>
<span id="cb7-67">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Forward through each head</span></span>
<span id="cb7-68">        birth_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.birth_year_head(task_embeddings)</span>
<span id="cb7-69">        occupation_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.occupation_head(task_embeddings)</span>
<span id="cb7-70"></span>
<span id="cb7-71">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Detach embeddings so that noisy gender does not affect the backbone</span></span>
<span id="cb7-72">        gender_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.gender_head(task_embeddings.detach())</span>
<span id="cb7-73"></span>
<span id="cb7-74">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Allow embeddings to be returned</span></span>
<span id="cb7-75">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.return_embeddings:</span>
<span id="cb7-76">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> birth_pred, gender_pred, occupation_pred, embeddings</span>
<span id="cb7-77"></span>
<span id="cb7-78">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> birth_pred, gender_pred, occupation_pred</span></code></pre></div></div>
</details>
</div>
</section>
<section id="training-parameters" class="level3">
<h3 class="anchored" data-anchor-id="training-parameters">Training Parameters</h3>
<p><u>Loss functions </u></p>
<ul>
<li><em>Gender loss</em>: The gender prediction head used binary cross-entropy (BCE). After empirical testing, the noisiness of the gender head was preventing the model from learning. To address this, I detached the embeddings before feeding them into the gender head, isolating gender backpropagation to the prediction head only.</li>
<li><em>Occupation loss</em>: I tested two loss functions for the occupation head, BCE and focal loss. Loss was calculated per occupation category, scaled by the previously calculated weights, and then averaged. This prevented the model from ignoring less common occupations.</li>
<li><em>Birth year loss</em>: Birth year loss was calculated using heteroskedastic negative log-likelihood (HNLL). HNLL requires the model to predict a normal distribution for each sample, allowing the model to strategically express uncertainty in its predictions. HNLL was chosen over MSE to reduce regression to the mean. HNLL also has the added benefit of including a measure of model uncertainty.</li>
</ul>
<p><u>Training Regime</u></p>
<ul>
<li><em>Phases</em>: The training regime was split into two phases. In the first phase, only the added layers and prediction heads are modified. In the second phase, the encoder model is also modified.</li>
<li><em>Optimizer</em>: AdamW was selected as the optimizer. The learning rate for the encoder, add-on layers, and each prediction head are set separately.</li>
<li><em>Scheduling</em>: The learning rate was scheduled with a linear warmup (10% of total batches) and linear decay (90% of batches). Scheduling reset between phases. The second phase had a proportionally lower learning rate than the first phase. The first phase lasted four epochs (empirically set based on when performance plateaued). The second phase lasted up to 12 epochs, depending on early stopping.</li>
<li><em>Evaluation</em>: Model performance was evaluated against a withheld validation set. The validation set contained 15% of the overall data. Model performance was calculated as the weighted average of task performance.
<ul>
<li><em>Gender</em>: AUROC</li>
<li><em>Year</em>: MAE</li>
<li><em>Occupation</em>: Hamming distance, with multi-label ‚Äúmacro‚Äù reduction. This places more emphasis on uncommon labels</li>
</ul></li>
</ul>
<div id="b1ca0f00" class="cell">
<details class="code-fold">
<summary>Training schedule and run functions</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">class</span> TrainSchedule:</span>
<span id="cb8-2">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">__init__</span>(</span>
<span id="cb8-3">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>,</span>
<span id="cb8-4">        model,</span>
<span id="cb8-5">        epochs_last_only,</span>
<span id="cb8-6">        epochs_joint,</span>
<span id="cb8-7">        train_dataloader,</span>
<span id="cb8-8">        val_dataloader,</span>
<span id="cb8-9">        birth_year_loss_fn,</span>
<span id="cb8-10">        gender_loss_fn,</span>
<span id="cb8-11">        occupation_loss_fn,</span>
<span id="cb8-12">        lr,</span>
<span id="cb8-13">        device,</span>
<span id="cb8-14">        reporting_and_early_stopping_weights: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>],</span>
<span id="cb8-15">        backprop_weights: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>],</span>
<span id="cb8-16">        joint_lr_multiplier,</span>
<span id="cb8-17">        early_stopping_epochs: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,</span>
<span id="cb8-18">        occupation_class_weights: torch.Tensor,</span>
<span id="cb8-19">    ):</span>
<span id="cb8-20">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model</span>
<span id="cb8-21">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs_last_only <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> epochs_last_only</span>
<span id="cb8-22">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs_joint <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> epochs_joint</span>
<span id="cb8-23">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.train_dataloader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> train_dataloader</span>
<span id="cb8-24">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.val_dataloader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val_dataloader</span>
<span id="cb8-25">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.birth_year_loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> birth_year_loss_fn</span>
<span id="cb8-26">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.gender_loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gender_loss_fn</span>
<span id="cb8-27">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.occupation_loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> occupation_loss_fn</span>
<span id="cb8-28">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> device</span>
<span id="cb8-29">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.early_stopping_epochs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> early_stopping_epochs</span>
<span id="cb8-30">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.lr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> lr</span>
<span id="cb8-31">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metric_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> reporting_and_early_stopping_weights</span>
<span id="cb8-32">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.backprop_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> backprop_weights</span>
<span id="cb8-33">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.joint_lr_multiplier <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> joint_lr_multiplier</span>
<span id="cb8-34">        <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.occupation_class_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> occupation_class_weights</span>
<span id="cb8-35"></span>
<span id="cb8-36">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> epoch(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>, train: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>):</span>
<span id="cb8-37">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> train:</span>
<span id="cb8-38">            dataloader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.train_dataloader</span>
<span id="cb8-39">            optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.optimizer</span>
<span id="cb8-40">            label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"train"</span></span>
<span id="cb8-41">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.train()</span>
<span id="cb8-42">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-43">            dataloader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.val_dataloader</span>
<span id="cb8-44">            optimizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb8-45">            label <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"val"</span></span>
<span id="cb8-46">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">eval</span>()</span>
<span id="cb8-47"></span>
<span id="cb8-48">        dl_gender <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb8-49">        dl_occupation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb8-50">        dl_year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb8-51">        dl_gender_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb8-52">        dl_occupation_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb8-53">        dl_year_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span></span>
<span id="cb8-54"></span>
<span id="cb8-55">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Metrics</span></span>
<span id="cb8-56">        gender_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> BinaryAUROC().to(device<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device)</span>
<span id="cb8-57">        year_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MeanAbsoluteError().to(device<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device)</span>
<span id="cb8-58">        year_std_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> StdMetric().to(device<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device)</span>
<span id="cb8-59">        occupation_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> MultilabelHammingDistance(</span>
<span id="cb8-60">            num_labels<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.occupation_classes, average<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"macro"</span></span>
<span id="cb8-61">        ).to(device<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device)</span>
<span id="cb8-62"></span>
<span id="cb8-63">        pbar <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> tqdm(dataloader, desc<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Avg loss"</span>)</span>
<span id="cb8-64"></span>
<span id="cb8-65">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> batch_idx, data <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">enumerate</span>(pbar):</span>
<span id="cb8-66">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> optimizer:</span>
<span id="cb8-67">                optimizer.zero_grad()</span>
<span id="cb8-68"></span>
<span id="cb8-69">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Extract targets and tokens</span></span>
<span id="cb8-70">            tokens <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"tokens"</span>].to(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device)</span>
<span id="cb8-71">            attention_mask <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"attention_mask"</span>].to(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device)</span>
<span id="cb8-72">            birth_target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year_target"</span>].to(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device).unsqueeze(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-73">            gender_target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender_dummy_male"</span>].to(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device).unsqueeze(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-74">            occupation_target <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> data[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation_target"</span>].to(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.device)</span>
<span id="cb8-75"></span>
<span id="cb8-76">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate model predictions</span></span>
<span id="cb8-77">            birth_pred, gender_pred, occupation_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model(</span>
<span id="cb8-78">                tokens, attention_mask<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>attention_mask</span>
<span id="cb8-79">            )</span>
<span id="cb8-80"></span>
<span id="cb8-81">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate loss per prediction head</span></span>
<span id="cb8-82">            year_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.birth_year_loss_fn(birth_pred, birth_target)</span>
<span id="cb8-83">            gender_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.gender_loss_fn(gender_pred, gender_target)</span>
<span id="cb8-84">            occupation_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.occupation_loss_fn(</span>
<span id="cb8-85">                occupation_pred, occupation_target</span>
<span id="cb8-86">            )</span>
<span id="cb8-87">            occupation_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> occupation_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.occupation_class_weights</span>
<span id="cb8-88">            occupation_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> occupation_loss.mean()</span>
<span id="cb8-89"></span>
<span id="cb8-90">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Weight the losses</span></span>
<span id="cb8-91">            year_loss_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> year_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.backprop_weights.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb8-92">            gender_loss_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gender_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.backprop_weights.get(</span>
<span id="cb8-93">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb8-94">            )</span>
<span id="cb8-95">            occupation_loss_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> occupation_loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.backprop_weights.get(</span>
<span id="cb8-96">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span></span>
<span id="cb8-97">            )</span>
<span id="cb8-98"></span>
<span id="cb8-99">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Create loss used for backprop</span></span>
<span id="cb8-100">            loss <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> year_loss_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gender_loss_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> occupation_loss_weighted</span>
<span id="cb8-101"></span>
<span id="cb8-102">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Backprop</span></span>
<span id="cb8-103">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> optimizer:</span>
<span id="cb8-104">                loss.backward()</span>
<span id="cb8-105">                optimizer.step()</span>
<span id="cb8-106">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.scheduler <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb8-107">                    <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.scheduler.step()</span>
<span id="cb8-108"></span>
<span id="cb8-109">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Calculate reporting metrics</span></span>
<span id="cb8-110">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> torch.no_grad():</span>
<span id="cb8-111">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.use_hetrosk_year_loss:</span>
<span id="cb8-112">                    birth_pred <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> birth_pred[:, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>].unsqueeze(dim<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb8-113"></span>
<span id="cb8-114">                year_metric.update(target<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>birth_target, preds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>birth_pred)</span>
<span id="cb8-115">                year_std_metric.update(birth_pred)</span>
<span id="cb8-116"></span>
<span id="cb8-117">                gender_metric.update(target<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gender_target, preds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gender_pred)</span>
<span id="cb8-118">                occupation_metric.update(</span>
<span id="cb8-119">                    target<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>occupation_target, preds<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>occupation_pred</span>
<span id="cb8-120">                )</span>
<span id="cb8-121"></span>
<span id="cb8-122">            dl_gender <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> gender_loss.item()</span>
<span id="cb8-123">            dl_occupation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> occupation_loss.item()</span>
<span id="cb8-124">            dl_year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> year_loss.item()</span>
<span id="cb8-125"></span>
<span id="cb8-126">            dl_gender_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> gender_loss_weighted.item()</span>
<span id="cb8-127">            dl_occupation_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> occupation_loss_weighted.item()</span>
<span id="cb8-128">            dl_year_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> year_loss_weighted.item()</span>
<span id="cb8-129"></span>
<span id="cb8-130">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># For tqdm reporting</span></span>
<span id="cb8-131">            pbar_dict <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-132">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>dl_gender <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (batch_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb8-133">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>dl_occupation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (batch_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb8-134">                <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>: <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>dl_year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> (batch_idx <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.4f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>,</span>
<span id="cb8-135">            }</span>
<span id="cb8-136">            pbar.set_postfix(pbar_dict)</span>
<span id="cb8-137"></span>
<span id="cb8-138">        <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># End of epoch metrics</span></span>
<span id="cb8-139">        n_batches <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(dataloader)</span>
<span id="cb8-140">        gender_metric_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> gender_metric.compute().item()</span>
<span id="cb8-141">        year_metric_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> year_metric.compute().item()</span>
<span id="cb8-142">        year_std_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> year_std_metric.compute().item()</span>
<span id="cb8-143">        occupation_metric_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> occupation_metric.compute().item()</span>
<span id="cb8-144"></span>
<span id="cb8-145">        target_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb8-146">            year_metric_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metric_weights.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb8-147">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> gender_metric_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metric_weights.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb8-148">            <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> occupation_metric_score <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.metric_weights.get(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>)</span>
<span id="cb8-149">        )</span>
<span id="cb8-150"></span>
<span id="cb8-151">        wandb_metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-152">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_target_metric"</span>: target_metric,</span>
<span id="cb8-153">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_gender_loss"</span>: dl_gender <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_batches,</span>
<span id="cb8-154">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_occupation_loss"</span>: dl_occupation <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_batches,</span>
<span id="cb8-155">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_year_loss"</span>: dl_year <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_batches,</span>
<span id="cb8-156">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_gender_loss_weighted"</span>: dl_gender_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_batches,</span>
<span id="cb8-157">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_occupation_loss_weighted"</span>: dl_occupation_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_batches,</span>
<span id="cb8-158">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_year_loss_weighted"</span>: dl_year_weighted <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> n_batches,</span>
<span id="cb8-159">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_gender_auc"</span>: gender_metric_score,</span>
<span id="cb8-160">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_year_MAE"</span>: year_metric_score,</span>
<span id="cb8-161">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_occupation_hamming"</span>: occupation_metric_score,</span>
<span id="cb8-162">            <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>label<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">_year_std"</span>: year_std_score,</span>
<span id="cb8-163">        }</span>
<span id="cb8-164">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">return</span> wandb_metrics</span>
<span id="cb8-165"></span>
<span id="cb8-166">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> phase(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb8-167">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.joint_flag:</span>
<span id="cb8-168">            total_epochs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs_last_only</span>
<span id="cb8-169">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-170">            total_epochs <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs_joint</span>
<span id="cb8-171"></span>
<span id="cb8-172">        best_target_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"inf"</span>)</span>
<span id="cb8-173">        epochs_since_best <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-174">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> epoch_n <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">range</span>(total_epochs):</span>
<span id="cb8-175"></span>
<span id="cb8-176">            start <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb8-177"></span>
<span id="cb8-178">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Epoch </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>epoch_n<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-179">            train_metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epoch(train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-180"></span>
<span id="cb8-181">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> torch.no_grad():</span>
<span id="cb8-182">                val_metrics <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epoch(train<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>)</span>
<span id="cb8-183"></span>
<span id="cb8-184">            target_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> val_metrics[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"val_target_metric"</span>]</span>
<span id="cb8-185">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"Target metric: </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>target_metric<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:.2f}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>, end<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">" | "</span>)</span>
<span id="cb8-186"></span>
<span id="cb8-187">            end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> time.time()</span>
<span id="cb8-188">            cur_is_best <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb8-189">            avg_learning_rate <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">sum</span>(</span>
<span id="cb8-190">                [group[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lr"</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> group <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.optimizer.param_groups]</span>
<span id="cb8-191">            ) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>([group[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lr"</span>] <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> group <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.optimizer.param_groups])</span>
<span id="cb8-192"></span>
<span id="cb8-193">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Save best model</span></span>
<span id="cb8-194">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> best_target_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> target_metric:</span>
<span id="cb8-195">                best_target_metric <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> target_metric</span>
<span id="cb8-196">                cur_is_best <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb8-197">                save_path <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> wandb.run.<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dir</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"/best_model.pt"</span></span>
<span id="cb8-198">                torch.save(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.state_dict(), save_path)</span>
<span id="cb8-199">                <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"New best model saved to </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>save_path<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-200"></span>
<span id="cb8-201">            wandb.log(</span>
<span id="cb8-202">                {</span>
<span id="cb8-203">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>train_metrics,</span>
<span id="cb8-204">                    <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">**</span>val_metrics,</span>
<span id="cb8-205">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"best_target_metric"</span>: best_target_metric,</span>
<span id="cb8-206">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"time"</span>: end <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span> start,</span>
<span id="cb8-207">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"epoch"</span>: epoch_n,</span>
<span id="cb8-208">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"phase"</span>: <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"joint"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.joint_flag <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"last-only"</span>,</span>
<span id="cb8-209">                    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"avg_lr"</span>: avg_learning_rate,</span>
<span id="cb8-210">                }</span>
<span id="cb8-211">            )</span>
<span id="cb8-212"></span>
<span id="cb8-213">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Early stopping</span></span>
<span id="cb8-214">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> (<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.early_stopping_epochs <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>) <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">and</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.joint_flag:</span>
<span id="cb8-215">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> cur_is_best:</span>
<span id="cb8-216">                    epochs_since_best <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-217">                <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-218">                    epochs_since_best <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span></span>
<span id="cb8-219">                    <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(</span>
<span id="cb8-220">                        <span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"No improvement in target metric for </span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>epochs_since_best<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;"> epochs."</span></span>
<span id="cb8-221">                    )</span>
<span id="cb8-222">                    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> epochs_since_best <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.early_stopping_epochs:</span>
<span id="cb8-223">                        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Early stopping triggered."</span>)</span>
<span id="cb8-224">                        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">break</span></span>
<span id="cb8-225"></span>
<span id="cb8-226">    <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> train(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>):</span>
<span id="cb8-227">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs_last_only <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb8-228">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Starting phase 1: Training added layers only."</span>)</span>
<span id="cb8-229">            <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Freeze parameters</span></span>
<span id="cb8-230">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> param <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.encoder.parameters():</span>
<span id="cb8-231">                param.requires_grad <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb8-232"></span>
<span id="cb8-233">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.optimizer, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.scheduler <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> build_optimizer_scheduler(</span>
<span id="cb8-234">                model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb8-235">                lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.lr,</span>
<span id="cb8-236">                total_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.train_dataloader) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs_last_only,</span>
<span id="cb8-237">                warmup_portion<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb8-238">            )</span>
<span id="cb8-239"></span>
<span id="cb8-240">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.joint_flag <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span></span>
<span id="cb8-241">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.phase()</span>
<span id="cb8-242"></span>
<span id="cb8-243">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs_joint <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>:</span>
<span id="cb8-244">            <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Starting phase 2: Joint training of all layers."</span>)</span>
<span id="cb8-245">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> param <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model.encoder.parameters():</span>
<span id="cb8-246">                param.requires_grad <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb8-247"></span>
<span id="cb8-248">            joint_lr <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-249">                key: val <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.joint_lr_multiplier <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> key, val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.lr.items()</span>
<span id="cb8-250">            }</span>
<span id="cb8-251">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.optimizer, <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.scheduler <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> build_optimizer_scheduler(</span>
<span id="cb8-252">                model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.model,</span>
<span id="cb8-253">                lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>joint_lr,</span>
<span id="cb8-254">                total_steps<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="bu" style="color: null;
background-color: null;
font-style: inherit;">len</span>(<span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.train_dataloader) <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.epochs_joint,</span>
<span id="cb8-255">                warmup_portion<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>,</span>
<span id="cb8-256">            )</span>
<span id="cb8-257"></span>
<span id="cb8-258">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.joint_flag <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span></span>
<span id="cb8-259">            <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">self</span>.phase()</span>
<span id="cb8-260"></span>
<span id="cb8-261">        <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Training complete"</span>)</span>
<span id="cb8-262"></span>
<span id="cb8-263"><span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">def</span> run(</span>
<span id="cb8-264">    batch_size: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">32</span>,</span>
<span id="cb8-265">    use_big_bone: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Use larger backbone model</span></span>
<span id="cb8-266">    lr: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-267">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"encoder"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-4</span>,</span>
<span id="cb8-268">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"add_on_layers"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-3</span>,</span>
<span id="cb8-269">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation_head"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-5</span>,</span>
<span id="cb8-270">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"birth_year_head"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-3</span>,</span>
<span id="cb8-271">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender_head"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1e-3</span>,</span>
<span id="cb8-272">    },</span>
<span id="cb8-273">    add_on_layer_dims: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">list</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> [</span>
<span id="cb8-274">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">256</span>,</span>
<span id="cb8-275">        <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">128</span>,</span>
<span id="cb8-276">    ],  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Latent dimension of each add-on layer</span></span>
<span id="cb8-277">    early_stopping_epochs: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Does not include initial epochs_last_only</span></span>
<span id="cb8-278">    epochs_last_only: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Epochs to train added layers and heads</span></span>
<span id="cb8-279">    epochs_joint: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Maxium epochs to train full model</span></span>
<span id="cb8-280">    data_limit: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Limit dataset size for quick debugging</span></span>
<span id="cb8-281">    dropout_p: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>,</span>
<span id="cb8-282">    target_metric_weights: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>[<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-283">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>,</span>
<span id="cb8-284">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.0</span>,</span>
<span id="cb8-285">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">2.0</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># To account for scale issues</span></span>
<span id="cb8-286">    },  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Weights for target early stopping (not backprop)</span></span>
<span id="cb8-287">    occupation_backprop_weight: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">5.0</span>,</span>
<span id="cb8-288">    extra_occupations_layer: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb8-289">    occupation_loss_type: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"focal"</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># 'BCE', 'focal'</span></span>
<span id="cb8-290">    joint_lr_multiplier: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>,</span>
<span id="cb8-291">    use_occupation_weights: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">False</span>,</span>
<span id="cb8-292">    occupation_classes: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">19</span>,</span>
<span id="cb8-293">    use_hetrosk_year_loss: <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>,</span>
<span id="cb8-294">):</span>
<span id="cb8-295">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize variables from settings</span></span>
<span id="cb8-296">    backprop_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-297">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"year"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>,</span>
<span id="cb8-298">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gender"</span>: <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.0</span>,  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Only impacts the prediction head</span></span>
<span id="cb8-299">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>: occupation_backprop_weight,</span>
<span id="cb8-300">    }</span>
<span id="cb8-301">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">not</span> add_on_layer_dims:</span>
<span id="cb8-302">        epochs_last_only <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span></span>
<span id="cb8-303">    occupation_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> (</span>
<span id="cb8-304">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/processed_data/occupation_weights.pkl"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> use_occupation_weights <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span></span>
<span id="cb8-305">    )</span>
<span id="cb8-306">    DATA_PATH <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"data/processed_data/quote_dataset.parquet"</span></span>
<span id="cb8-307">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> use_big_bone:</span>
<span id="cb8-308">        model_str <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all-mpnet-base-v2"</span></span>
<span id="cb8-309">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-310">        model_str <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"all-MiniLM-L6-v2"</span></span>
<span id="cb8-311"></span>
<span id="cb8-312">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Set device</span></span>
<span id="cb8-313">    device <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.device(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cuda"</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> torch.cuda.is_available() <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cpu"</span>)</span>
<span id="cb8-314"></span>
<span id="cb8-315">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Load tokenizer and encoder</span></span>
<span id="cb8-316">    tokenizer <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AutoTokenizer.from_pretrained(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"sentence-transformers/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>model_str<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>)</span>
<span id="cb8-317">    encoder <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AutoModel.from_pretrained(<span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">f"sentence-transformers/</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">{</span>model_str<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">}</span><span class="ss" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span>).to(device)</span>
<span id="cb8-318"></span>
<span id="cb8-319">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Get dataloaders</span></span>
<span id="cb8-320">    train_dataloader, val_dataloader <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> get_dataloaders(</span>
<span id="cb8-321">        dataframe_path<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>DATA_PATH,</span>
<span id="cb8-322">        tokenizer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>tokenizer,</span>
<span id="cb8-323">        batch_size<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>batch_size,</span>
<span id="cb8-324">        data_limit<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>data_limit,</span>
<span id="cb8-325">    )</span>
<span id="cb8-326"></span>
<span id="cb8-327">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize model</span></span>
<span id="cb8-328">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> AuthorPredictor(</span>
<span id="cb8-329">        encoder<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>encoder,</span>
<span id="cb8-330">        occupation_classes<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>occupation_classes,</span>
<span id="cb8-331">        device<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>device,</span>
<span id="cb8-332">        add_on_layer_dims<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>add_on_layer_dims,</span>
<span id="cb8-333">        dropout_p<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>dropout_p,</span>
<span id="cb8-334">        extra_occupations_layer<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>extra_occupations_layer,</span>
<span id="cb8-335">        use_hetrosk_year_loss<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>use_hetrosk_year_loss,</span>
<span id="cb8-336">    )</span>
<span id="cb8-337">    model <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> model.to(device)</span>
<span id="cb8-338"></span>
<span id="cb8-339">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Initialize loss functions</span></span>
<span id="cb8-340">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> use_hetrosk_year_loss:</span>
<span id="cb8-341">        birth_year_loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> HeteroskedasticNLL()</span>
<span id="cb8-342">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-343">        birth_year_loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.nn.MSELoss()</span>
<span id="cb8-344"></span>
<span id="cb8-345">    gender_loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.nn.BCEWithLogitsLoss()</span>
<span id="cb8-346"></span>
<span id="cb8-347">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> occupation_loss_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"BCE"</span>:</span>
<span id="cb8-348">        occupation_loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.nn.BCEWithLogitsLoss(reduction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span>)</span>
<span id="cb8-349">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">elif</span> occupation_loss_type <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">==</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"focal"</span>:</span>
<span id="cb8-350">        occupation_loss_fn <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> FocalLoss(</span>
<span id="cb8-351">            gamma<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, alpha<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.25</span>, task_type<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"multi-label"</span>, reduction<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"none"</span></span>
<span id="cb8-352">        )</span>
<span id="cb8-353">        backprop_weights[<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"occupation"</span>] <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*=</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Adjust for focal loss</span></span>
<span id="cb8-354">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-355">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">raise</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">AssertionError</span></span>
<span id="cb8-356"></span>
<span id="cb8-357">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> occupation_weights:</span>
<span id="cb8-358">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">with</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">open</span>(occupation_weights, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rb"</span>) <span class="im" style="color: #00769E;
background-color: null;
font-style: inherit;">as</span> f:</span>
<span id="cb8-359">            loaded_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> pickle.load(f)</span>
<span id="cb8-360">        occupation_class_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.tensor(loaded_weights).to(device)</span>
<span id="cb8-361">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-362">        occupation_class_weights <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> torch.ones(occupation_classes).to(device)</span>
<span id="cb8-363"></span>
<span id="cb8-364">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Schedule</span></span>
<span id="cb8-365">    training_schedule <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> TrainSchedule(</span>
<span id="cb8-366">        model<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>model,</span>
<span id="cb8-367">        epochs_last_only<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>epochs_last_only,</span>
<span id="cb8-368">        epochs_joint<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>epochs_joint,</span>
<span id="cb8-369">        train_dataloader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>train_dataloader,</span>
<span id="cb8-370">        val_dataloader<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>val_dataloader,</span>
<span id="cb8-371">        joint_lr_multiplier<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>joint_lr_multiplier,</span>
<span id="cb8-372">        birth_year_loss_fn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>birth_year_loss_fn,</span>
<span id="cb8-373">        gender_loss_fn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>gender_loss_fn,</span>
<span id="cb8-374">        occupation_loss_fn<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>occupation_loss_fn,</span>
<span id="cb8-375">        lr<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>lr,</span>
<span id="cb8-376">        device<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>device,</span>
<span id="cb8-377">        early_stopping_epochs<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>early_stopping_epochs,</span>
<span id="cb8-378">        reporting_and_early_stopping_weights<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>target_metric_weights,</span>
<span id="cb8-379">        backprop_weights<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>backprop_weights,</span>
<span id="cb8-380">        occupation_class_weights<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>occupation_class_weights,</span>
<span id="cb8-381">    )</span>
<span id="cb8-382"></span>
<span id="cb8-383">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># Base WandB config</span></span>
<span id="cb8-384">    base_config <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> {</span>
<span id="cb8-385">        key: val</span>
<span id="cb8-386">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">for</span> key, val <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">in</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">locals</span>().items()</span>
<span id="cb8-387">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">isinstance</span>(val, (<span class="bu" style="color: null;
background-color: null;
font-style: inherit;">int</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">float</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">str</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">bool</span>, <span class="bu" style="color: null;
background-color: null;
font-style: inherit;">dict</span>))</span>
<span id="cb8-388">    }</span>
<span id="cb8-389"></span>
<span id="cb8-390">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># This code allows for sweep runs (called from sweep_runner.py) and single runs</span></span>
<span id="cb8-391">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">if</span> wandb.run <span class="kw" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">is</span> <span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">None</span>:</span>
<span id="cb8-392">        wandb_run <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> wandb.init(project<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"project-name"</span>, config<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span>base_config)</span>
<span id="cb8-393">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">else</span>:</span>
<span id="cb8-394">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb8-395">            wandb.config.update(base_config, allow_val_change<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="va" style="color: #111111;
background-color: null;
font-style: inherit;">True</span>)</span>
<span id="cb8-396">        <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">except</span> <span class="pp" style="color: #AD0000;
background-color: null;
font-style: inherit;">Exception</span>:</span>
<span id="cb8-397">            <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">pass</span></span>
<span id="cb8-398">        wandb_run <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> wandb.run</span>
<span id="cb8-399"></span>
<span id="cb8-400">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">try</span>:</span>
<span id="cb8-401">        training_schedule.train()</span>
<span id="cb8-402">    <span class="cf" style="color: #003B4F;
background-color: null;
font-weight: bold;
font-style: inherit;">finally</span>:</span>
<span id="cb8-403">        wandb.finish()</span></code></pre></div></div>
</details>
</div>
</section>
<section id="model-training" class="level3">
<h3 class="anchored" data-anchor-id="model-training">Model Training</h3>
<p><u>Training Architecture</u></p>
<ul>
<li><em>GPU</em>: Model training was performed on cloud GPUs hosted on <a href="https://www.runpod.io/">Runpod</a>.</li>
<li><em>Metric Reporting</em>: Metric reporting, hyperparameter sweeps, and training monitoring were all done using <a href="https://wandb.ai/">Weights &amp; Biases</a>(WandB).</li>
<li><em>Hyperparameter sweeps</em>: I performed initial testing by varying loss functions, optimizers, scheduling, and model architecture. After finding a more limited range of options, I performed a Bayesian sweep over a variety of hyperparameters. I varied batch size, dropout, add-on layer depth and width, the scale factor on occupation loss, loss functions, and the second-phase learning-rate multiplier.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.liamgconnor.com/projects/quote-machine/index_files/figure-html/863f6fda-1-wandb_sweep_screenshot.png" class="img-fluid figure-img"></p>
<figcaption>Weights and Biases sweep dashboard graph</figcaption>
</figure>
</div>
</section>
<section id="model-serving" class="level3">
<h3 class="anchored" data-anchor-id="model-serving">Model Serving</h3>
<p>I used <a href="https://www.gradio.app/">Gradio</a> to build a shareable model interface. The classification portion required inverting data transformations and presenting the data in a (hopefully) visually appealing way. I hosted the Gradio interface in a <a href="https://huggingface.co/spaces">Hugging Face Space</a>.</p>
<p>I also wanted the model to be useful as a tool for finding relevant quotes. To do this, I first embedded all scraped quotes. Then, I used <a href="https://faiss.ai/">FAISS</a> to create an efficiently queryable index of the dense embeddings. For any entered quote, the interface retrieves the 100 most similar quotes by dot-product similarity. It then displays the five most similar quotes, filtered by the user‚Äôs selected ‚Äúminimum author popularity,‚Äù as measured by the <img src="https://latex.codecogs.com/png.latex?%5Clog_2"> of the author‚Äôs Wikipedia views.</p>
</section>
</section>
<section id="example-quotes" class="level2">
<h2 class="anchored" data-anchor-id="example-quotes">Example Quotes</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Quote</th>
<th>Author</th>
<th>Birth Year</th>
<th>Occupation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Virtue is debased by self-justification</td>
<td>Voltaire</td>
<td>1694</td>
<td>Film &amp; Theater Writer, Literature &amp; Writing, Humanities, Law &amp; Jurisprudence</td>
</tr>
<tr class="even">
<td>People like you to be something, preferably what they are.</td>
<td>John Steinbeck</td>
<td>1902</td>
<td>Literature &amp; Writing, Film &amp; Theater Writer</td>
</tr>
<tr class="odd">
<td>The severest justice may not always be the best policy</td>
<td>Abraham Lincoln</td>
<td>1809</td>
<td>Law &amp; Jurisprudence, Literature &amp; Writing, Politics &amp; Government, Military</td>
</tr>
<tr class="even">
<td>Allah is the Greatest. I‚Äôm just the greatest boxer.</td>
<td>Muhammad Ali</td>
<td>1942</td>
<td>Literature &amp; Writing, Athletes &amp; Sports, Social Advocacy</td>
</tr>
<tr class="odd">
<td>Tact is the ability to describe others as they see themselves</td>
<td>Unknown, commonly misattributed</td>
<td>~1925</td>
<td>See <a href="https://quoteinvestigator.com/2021/03/06/tact-see/">Quote Investigator</a></td>
</tr>
</tbody>
</table>
<!-- |In so far as theories of mathematics speak about reality, they are not certain, and in so far as they are certain, they do not speak about reality. | -->


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>I have a couple theories to explain this observation.</p>
<ol type="1">
<li>There is a specific style that both appeals to contemporary readers and sounds somewhat historical.</li>
<li>Mid-century newspaper editors, who apparently had a rather loose relationship with the truth, are the source of many misattributed quotes. The similar sound of missattributed quotes may come from a similar sound of these editors.</li>
</ol>
‚Ü©Ô∏é</li>
<li id="fn2"><p>I would take a different approach if I revisit this project. The current method greatly incentivizes away from predicting more recent years.‚Ü©Ô∏é</p></li>
</ol>
</section></div> ]]></description>
  <category>natural language processing</category>
  <category>data scraping</category>
  <category>ML</category>
  <category>AI</category>
  <category>interactive</category>
  <guid>https://www.liamgconnor.com/projects/quote-machine/</guid>
  <pubDate>Mon, 19 Jan 2026 07:00:00 GMT</pubDate>
  <media:content url="https://www.liamgconnor.com/projects/quote-machine/image.png" medium="image" type="image/png" height="128" width="144"/>
</item>
<item>
  <title>Certainty in Kidney Exchange</title>
  <link>https://www.liamgconnor.com/projects/kidney_certainty/</link>
  <description><![CDATA[ 




<style>
  .pdf-frame {
    margin-top: 1rem;  /* Adds space above the iframe */
    width: 100%;
    aspect-ratio: 8.5/11;
    border: 2px  solid var(--bs-body-color); 
    border-radius: 2px; 
  }
</style>
<p><br> This paper was prepared Fall 2024 for ECON 605: Advanced Microeconomics with Dr.&nbsp;Charles Becker. See the latest draft below.</p>
<iframe src="Connor, Liam_605_term paper final.pdf#zoom=FitH" class="pdf-frame">
</iframe>
<p><span style="color: rgba(255,255,255,0); font-size: 1px;">This text should not be visable. This is a hacky way to correct the expected reading time. I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I I </span></p>



 ]]></description>
  <category>kidney</category>
  <category>economics</category>
  <category>healthcare</category>
  <category>microeconomics</category>
  <category>policy</category>
  <category>paper</category>
  <guid>https://www.liamgconnor.com/projects/kidney_certainty/</guid>
  <pubDate>Thu, 16 Jan 2025 07:00:00 GMT</pubDate>
  <media:content url="https://www.liamgconnor.com/projects/kidney_certainty/feature.png" medium="image" type="image/png" height="143" width="144"/>
</item>
<item>
  <title>Great Salt Lake Policy Dashboard</title>
  <link>https://www.liamgconnor.com/</link>
  <description>The Great Salt Lake is drying up. Why should we care, and what can we do about it?</description>
  <category>great salt lake</category>
  <category>policy</category>
  <category>enviroment</category>
  <category>data visualization</category>
  <category>python</category>
  <category>interactive</category>
  <guid>https://www.liamgconnor.com/</guid>
  <pubDate>Mon, 16 Jan 2023 07:00:00 GMT</pubDate>
  <media:content url="https://www.liamgconnor.com/resources/gsl_animation.gif" medium="image" type="image/gif"/>
</item>
</channel>
</rss>
